# Phase 31 (개정판): 싱글 탭 우선 + 듀얼 윈도우 서브 시스템

**작성일**: 2025-12-03
**핵심 원칙**: 싱글 탭 = 기본 경험, 듀얼 윈도우 = 고급 옵션
**예상 소요**: 18-20시간 (3일)

---

## UX 철학: "Simple First, Power Later"

### 핵심 원칙
```
┌──────────────────────────────────────────────────────────────┐
│  1. 기본 경험은 싱글 탭                                       │
│     → 처음 사용자도 바로 시작 가능                            │
│     → 팝업 차단 걱정 없음                                     │
│     → 작은 화면(노트북)에서도 편안함                          │
├──────────────────────────────────────────────────────────────┤
│  2. 듀얼 윈도우는 "고급 모드"로 숨김                          │
│     → 설정 또는 토글로 접근                                   │
│     → 듀얼 모니터 사용자를 위한 옵션                          │
│     → 문제-해설 동시 조회 필요 시                             │
├──────────────────────────────────────────────────────────────┤
│  3. 점진적 공개 (Progressive Disclosure)                     │
│     → 기본 화면: 단순                                         │
│     → 고급 옵션: 필요할 때만 노출                             │
└──────────────────────────────────────────────────────────────┘
```

---

## 사용자 여정 (User Journey)

### 신규 사용자
```
Dashboard
   │
   ▼
┌─────────────────────────────────────┐
│  문제-해설 매칭                      │
│  ─────────────────────────────────  │
│  문제 PDF: [선택]                   │
│  해설 PDF: [선택]                   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │     📑 매칭 시작하기        │   │  ← 싱글 탭 (기본)
│  └─────────────────────────────┘   │
│                                     │
│  ⚙️ 듀얼 모니터 모드              │  ← 작은 링크 (서브)
└─────────────────────────────────────┘
```

### 고급 사용자 (듀얼 모니터)
```
"⚙️ 듀얼 모니터 모드" 클릭
   │
   ▼
┌─────────────────────────────────────┐
│  💡 듀얼 모니터를 사용하시나요?     │
│                                     │
│  문제와 해설을 나란히 보면서        │
│  작업할 수 있습니다.                │
│                                     │
│  ┌─────────────────────────────┐   │
│  │   🖥️🖥️ 듀얼 윈도우로 열기   │   │
│  └─────────────────────────────┘   │
│                                     │
│  ⚠️ 팝업 차단을 해제해야 합니다    │
└─────────────────────────────────────┘
```

---

## UI 설계

### 1. Dashboard - 매칭 카드

```
┌─────────────────────────────────────────────────────────┐
│  📚 문제-해설 매칭                                       │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌───────────────────┐  ┌───────────────────┐          │
│  │  📄 문제 PDF      │  │  📖 해설 PDF      │          │
│  │                   │  │                   │          │
│  │  [파일 선택]      │  │  [파일 선택]      │          │
│  │  또는 드래그      │  │  또는 드래그      │          │
│  └───────────────────┘  └───────────────────┘          │
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │               📑 매칭 시작하기                   │   │
│  │         (싱글 탭에서 순차적으로 작업)            │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │
│                                                         │
│  🖥️ 듀얼 모니터 사용 중이신가요?                       │
│     문제와 해설을 나란히 보면서 작업 →                  │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 2. 싱글 탭 뷰어 (기본)

```
┌──────────────────────────────────────────────────────────────┐
│  📄 베이직쎈_문제.pdf          [문제] [해설]    [🖥️ 분리]   │
├──────────────────────────────────────────────────────────────┤
│  ┌────────────────────────────┬───────────────────────────┐  │
│  │                            │  📋 문제 목록 (5/12)      │  │
│  │                            │  ─────────────────────────│  │
│  │      PDF 캔버스            │  ⬤ 1번  베이직쎈_p18    │  │
│  │    (문제 또는 해설)         │  ⬤ 2번  베이직쎈_p18    │  │
│  │                            │  ○ 3번  베이직쎈_p19    │  │
│  │                            │  ▶ 4번  베이직쎈_p19 ◀  │  │
│  │                            │  ○ 5번  베이직쎈_p20    │  │
│  │                            │  ─────────────────────────│  │
│  │                            │                           │  │
│  │                            │  ┌─────────────────────┐  │  │
│  │                            │  │  [문제 미리보기]    │  │  │
│  │                            │  │   4번 문제 썸네일   │  │  │
│  │                            │  └─────────────────────┘  │  │
│  │                            │                           │  │
│  │                            │  "해설을 그룹핑하세요"    │  │
│  │                            │                           │  │
│  │                            │  ─────────────────────────│  │
│  │                            │  진행률: 5/12 (42%)       │  │
│  │                            │  ████████░░░░░░░░░░░░     │  │
│  └────────────────────────────┴───────────────────────────┘  │
│  ← →: 페이지 | G: 그룹 | ↑↓: 문제 선택 | Tab: 다음 미연결    │
└──────────────────────────────────────────────────────────────┘
                                                    │
                                           [🖥️ 분리] 클릭
                                                    │
                                                    ▼
                                        듀얼 윈도우로 전환
```

### 3. [🖥️ 분리] 버튼 동작

```
[🖥️ 분리] 클릭 시:
   │
   ▼
┌─────────────────────────────────────┐
│  💡 듀얼 윈도우 모드                │
│                                     │
│  해설 창을 새 윈도우로 분리합니다.  │
│  문제와 해설을 동시에 볼 수 있어요. │
│                                     │
│  ┌─────────────┐ ┌─────────────┐   │
│  │   취소      │ │   분리하기  │   │
│  └─────────────┘ └─────────────┘   │
│                                     │
│  ℹ️ 팝업 차단 시 허용이 필요합니다  │
└─────────────────────────────────────┘
```

---

## 단계별 개발 계획

### Phase 31-A: 기본 구조 및 라우팅 (2시간)
**상태**: [ ] 승인 대기

**작업 내용**:
- [ ] 새 라우트 추가: `/matching/:problemDocId/:solutionDocId`
- [ ] UnifiedMatchingPage.tsx 생성 (메인 페이지)
- [ ] 기본 레이아웃 (헤더 + 캔버스 + 패널)

**생성 파일**:
```
frontend/src/pages/UnifiedMatchingPage.tsx
```

**수정 파일**:
```
frontend/src/App.tsx (라우트 추가)
```

---

### Phase 31-B: Dashboard 매칭 카드 개편 (2시간)
**상태**: [ ] 승인 대기

**작업 내용**:
- [ ] 기존 DualUploadCard 리팩토링 → MatchingCard
- [ ] "매칭 시작하기" 버튼 = 싱글 탭 (기본)
- [ ] "듀얼 모니터 모드" 링크 = 서브 옵션
- [ ] UX 라이팅 개선

**수정 파일**:
```
frontend/src/components/matching/DualUploadCard.tsx → MatchingCard.tsx
frontend/src/pages/Dashboard.tsx
```

**UI 코드 스니펫**:
```tsx
<div className="space-y-4">
  {/* 메인 버튼: 싱글 탭 */}
  <Button
    onClick={handleStartSingleTab}
    variant="primary"
    size="lg"
    className="w-full"
    disabled={!problemDocId || !solutionDocId}
  >
    <FileText className="w-5 h-5 mr-2" />
    매칭 시작하기
  </Button>
  <p className="text-center text-sm text-gray-500">
    싱글 탭에서 문제와 해설을 순차적으로 연결합니다
  </p>

  {/* 서브 옵션: 듀얼 윈도우 */}
  <div className="pt-4 border-t border-gray-200">
    <button
      onClick={handleShowDualOption}
      className="flex items-center gap-2 text-sm text-gray-500 hover:text-blue-600"
    >
      <Monitor className="w-4 h-4" />
      듀얼 모니터 사용 중이신가요? →
    </button>
  </div>
</div>
```

---

### Phase 31-C: 탭 헤더 + 분리 버튼 (2시간)
**상태**: [ ] 승인 대기

**작업 내용**:
- [ ] MatchingHeader 컴포넌트 생성
- [ ] 문제/해설 탭 전환
- [ ] [🖥️ 분리] 버튼 (듀얼 윈도우 전환)
- [ ] 현재 문서명 표시

**생성 파일**:
```
frontend/src/components/unified/MatchingHeader.tsx
```

**UI**:
```
┌─────────────────────────────────────────────────────────┐
│  📄 베이직쎈_문제.pdf                                    │
│                                                          │
│  ┌──────────┐ ┌──────────┐              ┌───────────┐   │
│  │ 📝 문제  │ │ 📖 해설  │              │ 🖥️ 분리  │   │
│  │  12문제  │ │  5연결   │              └───────────┘   │
│  └──────────┘ └──────────┘                               │
└─────────────────────────────────────────────────────────┘
```

---

### Phase 31-D: 상태 관리 (Zustand) (2시간)
**상태**: [ ] 승인 대기

**작업 내용**:
- [ ] useMatchingStore 생성
- [ ] 문제/해설 그룹 상태
- [ ] 선택 상태 + 연결 정보
- [ ] persist 설정 (새로고침 시 유지)

**생성 파일**:
```
frontend/src/stores/matchingStore.ts
```

**스토어 구조**:
```typescript
interface MatchingStore {
  // 모드
  viewMode: 'single' | 'dual';
  setViewMode: (mode: 'single' | 'dual') => void;

  // 활성 탭 (싱글 모드용)
  activeTab: 'problem' | 'solution';
  setActiveTab: (tab: 'problem' | 'solution') => void;

  // 문제 그룹
  problemGroups: ProblemGroup[];

  // 선택된 문제 (해설 연결용)
  selectedProblemId: string | null;

  // 연결 정보
  links: Record<string, string>;  // problemId → solutionId

  // 액션
  createLink: (problemId: string, solutionId: string) => void;
  selectNextUnlinked: () => void;
}
```

---

### Phase 31-E: 문제 목록 패널 (3시간)
**상태**: [ ] 승인 대기

**작업 내용**:
- [ ] ProblemListPanel 컴포넌트 생성
- [ ] 문제 목록 (연결 상태 표시)
- [ ] 클릭으로 문제 선택
- [ ] 키보드 네비게이션 (↑↓, Tab)

**생성 파일**:
```
frontend/src/components/unified/ProblemListPanel.tsx
```

**상태 아이콘**:
```
○ 미연결 (gray-300)
⬤ 연결됨 (green-500)
▶ 현재 선택 (blue-500, 애니메이션)
```

---

### Phase 31-F: 캔버스 영역 연동 (3시간)
**상태**: [ ] 승인 대기

**작업 내용**:
- [ ] 탭에 따라 문서 ID 전환
- [ ] 기존 PageViewer 재사용
- [ ] 해설 그룹 생성 시 자동 연결
- [ ] 연결 후 다음 문제 자동 선택

**핵심 로직**:
```typescript
// 해설 탭에서 그룹 생성
const handleCreateSolutionGroup = (group: ProblemGroup) => {
  if (selectedProblemId) {
    // 자동 연결
    createLink(selectedProblemId, group.id);
    showToast(`${selectedProblem.problemNumber}번 해설 연결 완료`, 'success');

    // 다음 미연결 문제로 이동
    selectNextUnlinked();
  }
};
```

---

### Phase 31-G: 문제 미리보기 (2시간)
**상태**: [ ] 승인 대기

**작업 내용**:
- [ ] ProblemPreview 컴포넌트
- [ ] 선택된 문제 썸네일 로드
- [ ] 연결 안내 메시지

**UI**:
```
┌─────────────────────────┐
│  선택: 4번 문제         │
│  베이직쎈_공통수학1_p19  │
│  ───────────────────────│
│  ┌─────────────────┐   │
│  │                 │   │
│  │   [썸네일]      │   │
│  │                 │   │
│  └─────────────────┘   │
│                         │
│  💡 이 문제의 해설을   │
│     그룹핑하세요        │
└─────────────────────────┘
```

---

### Phase 31-H: 듀얼 윈도우 분리 기능 (2시간)
**상태**: [ ] 승인 대기

**작업 내용**:
- [ ] [분리] 버튼 클릭 → 확인 모달
- [ ] 해설 창 새 윈도우로 분리
- [ ] 기존 BroadcastChannel 연동 재활용
- [ ] 싱글 → 듀얼 전환 로직

**분리 흐름**:
```
싱글 탭 (문제+해설)
       │
       │ [🖥️ 분리] 클릭
       ▼
┌─────────────────┐     ┌─────────────────┐
│  문제 창        │     │  해설 창 (새창)  │
│  (현재 탭)      │◄───►│  (팝업)         │
└─────────────────┘     └─────────────────┘
```

---

### Phase 31-I: 키보드 단축키 (1시간)
**상태**: [ ] 승인 대기

**작업 내용**:
- [ ] 문제 선택 이동 (↑↓)
- [ ] 다음 미연결 (Tab)
- [ ] 탭 전환 (1, 2)
- [ ] 단축키 힌트 표시

**단축키**:
```
공통:
  G       : 그룹 생성
  ← →     : 페이지 이동
  Ctrl+S  : 저장
  Esc     : 선택 해제

해설 탭:
  ↑ ↓     : 문제 선택
  Tab     : 다음 미연결 문제

탭 전환:
  1       : 문제 탭
  2       : 해설 탭
```

---

### Phase 31-J: 진행률 + 완료 축하 (1시간)
**상태**: [ ] 승인 대기

**작업 내용**:
- [ ] 진행률 바 (연결된 문제 / 전체)
- [ ] 100% 완료 시 축하 애니메이션
- [ ] 결과 저장 안내

**완료 UI**:
```
┌─────────────────────────────────────┐
│  🎉 모든 문제가 연결되었습니다!     │
│                                     │
│  총 12개 문제 → 12개 해설 연결      │
│                                     │
│  ┌─────────────────────────────┐   │
│  │        저장 완료            │   │
│  └─────────────────────────────┘   │
└─────────────────────────────────────┘
```

---

## 개발 순서 (의존성 기반)

```
Phase 31-A (기본 구조)
    │
    ├──► Phase 31-B (Dashboard 개편)
    │
    ├──► Phase 31-C (탭 헤더)
    │
    └──► Phase 31-D (상태 관리)
              │
              ├──► Phase 31-E (문제 목록 패널)
              │         │
              │         └──► Phase 31-G (미리보기)
              │
              └──► Phase 31-F (캔버스 연동)
                        │
                        ├──► Phase 31-H (듀얼 분리)
                        │
                        ├──► Phase 31-I (키보드)
                        │
                        └──► Phase 31-J (진행률)
```

---

## 예상 시간 요약

| Phase | 내용 | 시간 |
|-------|------|------|
| 31-A | 기본 구조 및 라우팅 | 2시간 |
| 31-B | Dashboard 매칭 카드 개편 | 2시간 |
| 31-C | 탭 헤더 + 분리 버튼 | 2시간 |
| 31-D | 상태 관리 (Zustand) | 2시간 |
| 31-E | 문제 목록 패널 | 3시간 |
| 31-F | 캔버스 영역 연동 | 3시간 |
| 31-G | 문제 미리보기 | 2시간 |
| 31-H | 듀얼 윈도우 분리 | 2시간 |
| 31-I | 키보드 단축키 | 1시간 |
| 31-J | 진행률 + 완료 | 1시간 |
| **합계** | | **20시간** |

---

## 파일 구조

```
frontend/src/
├── pages/
│   └── UnifiedMatchingPage.tsx     # 통합 매칭 페이지 (신규)
│
├── components/
│   ├── unified/                     # 통합 뷰어 컴포넌트 (신규)
│   │   ├── index.ts
│   │   ├── MatchingHeader.tsx      # 탭 헤더 + 분리 버튼
│   │   ├── ProblemListPanel.tsx    # 문제 목록 패널
│   │   ├── ProblemPreview.tsx      # 문제 미리보기
│   │   └── CompletionCelebration.tsx # 완료 축하
│   │
│   └── matching/
│       └── MatchingCard.tsx         # 개편된 매칭 카드 (수정)
│
├── stores/
│   └── matchingStore.ts             # Zustand 스토어 (신규)
│
└── App.tsx                          # 라우트 추가 (수정)
```

---

## 기존 코드 활용

| 기존 | 재사용 방식 |
|------|------------|
| PageViewer | 그대로 사용 (documentId props만 변경) |
| GroupPanel | 그대로 사용 |
| useSyncChannel | 듀얼 모드 전환 시 재활용 |
| useDualWindowLauncher | 분리 기능에서 재활용 |

---

## 승인 체크리스트

### 필수 (싱글 탭 기본 경험)
- [ ] 31-A: 기본 구조 및 라우팅
- [ ] 31-B: Dashboard 매칭 카드 개편
- [ ] 31-C: 탭 헤더
- [ ] 31-D: 상태 관리
- [ ] 31-E: 문제 목록 패널
- [ ] 31-F: 캔버스 영역 연동

### 권장 (UX 향상)
- [ ] 31-G: 문제 미리보기
- [ ] 31-I: 키보드 단축키
- [ ] 31-J: 진행률 + 완료

### 선택 (듀얼 모니터 지원)
- [ ] 31-H: 듀얼 윈도우 분리 기능

---

**진행하시려면 "진행해줘"라고 말씀해주세요.**

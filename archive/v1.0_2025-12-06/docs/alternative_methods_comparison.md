# v_kernel ëŒ€ì•ˆ ë°©ë²• ì¢…í•© ë¹„êµ

## ìš”ì•½

v_kernel ì¦ê°€ ëŒ€ì‹  **Distance Transform í›„ì²˜ë¦¬**ê°€ ê°€ì¥ íš¨ê³¼ì ì…ë‹ˆë‹¤.

---

## í…ŒìŠ¤íŠ¸í•œ ë°©ë²•ë“¤

### ë°©ë²• 1: Distance Transform ê¸°ë°˜ BBox í™•ì¥

**ì›ë¦¬**:
- ì´ë¯¸ ê²€ì¶œëœ ì¸í…Œê·¸ë„ ë¸”ë¡ ì£¼ë³€ì˜ í”½ì…€ ê±°ë¦¬ë¥¼ ê³„ì‚°
- ê±°ë¦¬ê°€ ê°€ê¹Œìš´ í”½ì…€ë“¤ì„ ì°¾ì•„ bbox í™•ì¥
- min_pixel_densityë¡œ ë…¸ì´ì¦ˆ í•„í„°ë§

**ê²°ê³¼**:
| í•­ëª© | ê°’ |
|------|-----|
| í™•ì¥ëœ ë¸”ë¡ | 9/9ê°œ (100%) |
| í‰ê·  í™•ì¥ | 8.3px |
| ìµœëŒ€ í™•ì¥ | 16px (ë¸”ë¡ 151) |
| Aspect < 0.15 | 0ê°œ |

**ì¥ì **:
- âœ… ëª¨ë“  ë¸”ë¡ í™•ì¥ ì„±ê³µ
- âœ… í‰ê·  8.3px í™•ì¥ìœ¼ë¡œ ì˜ë¦¼ ë¬¸ì œ ì™„í™”
- âœ… ê¸°ì¡´ ê²€ì¶œ ë¡œì§ ìœ ì§€, í›„ì²˜ë¦¬ë§Œ ì¶”ê°€
- âœ… êµ¬í˜„ì´ ê°„ë‹¨í•˜ê³  ì•ˆì •ì 

**ë‹¨ì **:
- âŒ X ë°©í–¥ìœ¼ë¡œë„ í™•ì¥ë˜ì–´ aspect ratioê°€ ì•½ê°„ ì¦ê°€
- âŒ í‰ê·  8.3pxëŠ” í° í™•ì¥ì€ ì•„ë‹˜

**í‰ê°€**: â­â­â­â­â­ (5/5) - **ê°€ì¥ ê¶Œì¥**

---

### ë°©ë²• 2: Vertical Projection Profile

**ì›ë¦¬**:
- ê° ì„¸ë¡œ ë¸”ë¡ì˜ X ë²”ìœ„ì—ì„œ Y ë°©í–¥ í”½ì…€ ë¶„í¬ ë¶„ì„
- `np.sum(mask, axis=1)`ë¡œ ê° í–‰ì˜ í”½ì…€ í•© ê³„ì‚°
- í”½ì…€ì´ ìˆëŠ” í–‰ê¹Œì§€ bbox í™•ì¥
- min_densityë¡œ ìœ íš¨í•œ í–‰ íŒë³„

**ê²°ê³¼**:
| í•­ëª© | ê°’ |
|------|-----|
| í™•ì¥ëœ ë¸”ë¡ | 9/9ê°œ (100%) |
| í‰ê·  í™•ì¥ | 5.0px |
| ìµœëŒ€ í™•ì¥ | 13px (ë¸”ë¡ 100) |
| Aspect < 0.15 | 6ê°œ â­ |

**ì¥ì **:
- âœ… ëª¨ë“  ë¸”ë¡ í™•ì¥ ì„±ê³µ
- âœ… Aspect ratioê°€ ê°œì„ ë¨ (6ê°œê°€ 0.15 ë¯¸ë§Œ)
- âœ… Y ë°©í–¥ë§Œ í™•ì¥í•˜ì—¬ ì •í™•í•¨
- âœ… Projection profile ì‹œê°í™”ë¡œ ë””ë²„ê¹… ìš©ì´

**ë‹¨ì **:
- âŒ í‰ê·  5.0pxë¡œ Distance Transform(8.3px)ë³´ë‹¤ ë³´ìˆ˜ì 
- âŒ min_density íŒŒë¼ë¯¸í„° íŠœë‹ í•„ìš”

**í‰ê°€**: â­â­â­â­ (4/5) - **ë¶€ê°€ì ìœ¼ë¡œ ê¶Œì¥**

---

### ë°©ë²• 3: Contour ê¸°ë°˜ ì§ì ‘ ê²€ì¶œ

**ì›ë¦¬**:
- Morphology ì—†ì´ cv2.findContours()ë¡œ ì§ì ‘ ìœ¤ê³½ ê²€ì¶œ
- ê° contourì˜ bounding box ê³„ì‚°
- Aspect ratioë¡œ ì„¸ë¡œ contour í•„í„°ë§
- Y ë°©í–¥ìœ¼ë¡œ ê°€ê¹Œìš´ contour ë³‘í•©

**ê²°ê³¼**:
| í•­ëª© | ê°’ |
|------|-----|
| ì´ Contour | 699ê°œ |
| ì„¸ë¡œ Contour | 71ê°œ (aspect < 0.5) |
| ë³‘í•© í›„ | 68ê°œ |
| ì¸í…Œê·¸ë„ ê²€ì¶œ | **1ê°œ** âŒ |

**ì¥ì **:
- âœ… Morphology ì™œê³¡ ì—†ìŒ
- âœ… ì›ë³¸ í”½ì…€ í˜•íƒœ ê·¸ëŒ€ë¡œ ì‚¬ìš©
- âœ… ê²½ê³„ê°€ ì •í™•í•¨

**ë‹¨ì **:
- âŒ ì¸í…Œê·¸ë„ì´ ì—¬ëŸ¬ ì¡°ê°ìœ¼ë¡œ ìª¼ê°œì ¸ ìˆì–´ ê°ê°ì´ ë³„ë„ contour
- âŒ ë³‘í•© ë¡œì§ì´ ë³µì¡í•˜ê³  íŒŒë¼ë¯¸í„° íŠœë‹ ì–´ë ¤ì›€
- âŒ **1ê°œë§Œ ê²€ì¶œ** (Morphology 7ê°œ vs Contour 1ê°œ)
- âŒ v_kernel ì—†ì´ëŠ” ì¡°ê° ì—°ê²° ë¶ˆê°€ëŠ¥

**í‰ê°€**: â­â­ (2/5) - **ê¶Œì¥í•˜ì§€ ì•ŠìŒ**

---

## ì¢…í•© ë¹„êµí‘œ

| ë°©ë²• | í™•ì¥ ì„±ê³µë¥  | í‰ê·  í™•ì¥ | Aspect<0.15 | êµ¬í˜„ ë‚œì´ë„ | ì•ˆì •ì„± | ê¶Œì¥ë„ |
|------|-------------|-----------|-------------|-------------|--------|--------|
| **Distance Transform** | 100% (9/9) | 8.3px | 0ê°œ | ì‰¬ì›€ | ë†’ìŒ | â­â­â­â­â­ |
| **Vertical Projection** | 100% (9/9) | 5.0px | 6ê°œ | ë³´í†µ | ë†’ìŒ | â­â­â­â­ |
| **Contour ì§ì ‘ ê²€ì¶œ** | - | - | 1ê°œ | ì–´ë ¤ì›€ | ë‚®ìŒ | â­â­ |
| v_kernel=35 | - | - | 6ê°œ | - | **ë¸”ë¡ -10%** âŒ | â­â­ |
| v_kernel=50 | - | - | 6ê°œ | - | **ë¸”ë¡ -47%** âŒ | â­ |

---

## ìµœì¢… ê¶Œì¥ ì‚¬í•­

### âœ… ì¦‰ì‹œ ì ìš©: Distance Transform í›„ì²˜ë¦¬

**ì´ìœ **:
1. ëª¨ë“  ì¸í…Œê·¸ë„ ë¸”ë¡ì´ í‰ê·  8.3px í™•ì¥ë¨
2. 100% ì„±ê³µë¥ 
3. ê¸°ì¡´ ê²€ì¶œ ë¡œì§ ìœ ì§€, í›„ì²˜ë¦¬ë§Œ ì¶”ê°€
4. êµ¬í˜„ì´ ê°„ë‹¨í•˜ê³  ì•ˆì •ì 
5. v_kernel ì¦ê°€ì˜ ë¶€ì‘ìš©(ë¸”ë¡ ê°ì†Œ) ì—†ìŒ

**ì ìš© ìœ„ì¹˜**: `multiscale_analyzer.py` â†’ `_merge_vertical_fragments()` í•¨ìˆ˜ ë§ˆì§€ë§‰ì— ì¶”ê°€

**ì½”ë“œ ì˜ˆì‹œ**:
```python
def _merge_vertical_fragments(self, blocks: List[BoundingBox], mask: np.ndarray) -> List[BoundingBox]:
    # ... ê¸°ì¡´ ë³‘í•© ë¡œì§ ...

    # Distance Transform ê¸°ë°˜ í™•ì¥ (í›„ì²˜ë¦¬)
    expanded_blocks = []
    for block in merged:
        expanded_bbox = self._expand_with_distance_transform(mask, block.to_bbox())
        expanded_blocks.append(BoundingBox.from_bbox(expanded_bbox, ...))

    return expanded_blocks
```

### ğŸ”„ ì„ íƒì  ì¶”ê°€: Vertical Projection Profile

**ì¡°ê±´**: Distance Transformë§Œìœ¼ë¡œ ë¶€ì¡±í•œ ê²½ìš°

**ì´ìœ **:
- Aspect ratioê°€ ë” ì¢‹ìŒ (6ê°œê°€ 0.15 ë¯¸ë§Œ)
- Y ë°©í–¥ë§Œ í™•ì¥í•˜ì—¬ ì •í™•í•¨
- Distance Transformê³¼ í•¨ê»˜ ì‚¬ìš© ê°€ëŠ¥

---

## êµ¬í˜„ ìš°ì„ ìˆœìœ„

### 1ë‹¨ê³„: Distance Transform í†µí•© (í•„ìˆ˜)
- `multiscale_analyzer.py`ì— `_expand_with_distance_transform()` ë©”ì„œë“œ ì¶”ê°€
- `_merge_vertical_fragments()` ë§ˆì§€ë§‰ì— í˜¸ì¶œ
- íŒŒë¼ë¯¸í„°: `max_distance=30, min_pixel_density=0.03`

### 2ë‹¨ê³„: í…ŒìŠ¤íŠ¸ ë° ê²€ì¦
- `process_test_pdf.py` ì¬ì‹¤í–‰
- ì¸í…Œê·¸ë„ ê²€ì¶œ ê²°ê³¼ í™•ì¸
- `visualize_final_result.py`ë¡œ ì‹œê°í™”

### 3ë‹¨ê³„: íŒŒë¼ë¯¸í„° íŠœë‹ (í•„ìš”ì‹œ)
- `max_distance` ì¡°ì • (20 ~ 50)
- `min_pixel_density` ì¡°ì • (0.01 ~ 0.10)
- X ë°©í–¥ í™•ì¥ ì œí•œ ê³ ë ¤

---

## íš¨ê³¼ ì˜ˆì¸¡

### Distance Transform ì ìš© ì „ (í˜„ì¬)
- ì¸í…Œê·¸ë„ í›„ë³´: 7ê°œ (v_kernel=30)
- í‰ê·  ë†’ì´: 106px
- ì˜ë¦¼: 10/11ê°œ ë¸”ë¡ (í‰ê·  ìœ„ 10px, ì•„ë˜ 2px)

### Distance Transform ì ìš© í›„ (ì˜ˆìƒ)
- ì¸í…Œê·¸ë„ í›„ë³´: 7ê°œ ìœ ì§€
- í‰ê·  ë†’ì´: **114px** (+8px)
- ì˜ë¦¼: **0~2/11ê°œ** (ëŒ€ë¶€ë¶„ í•´ê²°)
- ë¶€ì‘ìš©: ì—†ìŒ (ë¸”ë¡ ìˆ˜ ìœ ì§€)

---

## ê²°ë¡ 

| ë°©ë²• | ê²°ê³¼ |
|------|------|
| âŒ v_kernel ì¦ê°€ (35/50) | ë¸”ë¡ ê°ì†Œ (-10% ~ -47%), ì¸í…Œê·¸ë„ë„ ê°ì†Œ |
| âœ… **Distance Transform** | **ëª¨ë“  ë¸”ë¡ 8.3px í™•ì¥, ë¶€ì‘ìš© ì—†ìŒ** |
| âœ… Vertical Projection | ë³´ìˆ˜ì ì´ì§€ë§Œ aspect ratio ê°œì„  |
| âŒ Contour ì§ì ‘ ê²€ì¶œ | 1ê°œë§Œ ê²€ì¶œ, ë¹„íš¨ìœ¨ì  |

**ìµœì¢… ê¶Œì¥**: Distance Transform í›„ì²˜ë¦¬ë¥¼ `multiscale_analyzer.py`ì— í†µí•©í•˜ì—¬ ì¸í…Œê·¸ë„ ì™„ì „ë„ë¥¼ í–¥ìƒì‹œí‚µë‹ˆë‹¤.

---

*ë¶„ì„ ì¼ì‹œ: 2025-11-16*
*í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸:*
- `test_distance_transform_merge.py` - Distance Transform
- `test_vertical_projection.py` - Vertical Projection
- `test_contour_detection.py` - Contour ê²€ì¶œ

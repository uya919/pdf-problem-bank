# Phase E-H 상세 개발 로드맵

**작성일**: 2025-12-01
**작성자**: Claude Code (Opus)
**버전**: 1.0

---

## 현재 완료된 Phase 요약

| Phase | 내용 | 상태 |
|-------|------|------|
| A | 한글 파일 파싱 (HML/HWPX) | ✅ 완료 |
| B | 통합 문제은행 | ✅ 완료 |
| C | 한글 → 문제은행 통합 | ✅ 완료 |
| D-1 | ExamPaper 백엔드 (모델, 서비스, API) | ✅ 완료 |
| D-2 | ExamBuilder UI (목록, 편집 페이지) | ✅ 완료 |
| D-3 | 설정/미리보기 모달 | ✅ 완료 |

---

## Phase E: 시험지 내보내기 기능

### E-1: PDF 내보내기 (우선순위: 높음)

**목표**: 시험지를 인쇄 가능한 PDF로 내보내기

**백엔드 구현**:

```
backend/app/services/exam/
├── pdf_exporter.py      # PDF 생성 서비스
└── __init__.py
```

**기술 스택**:
- `reportlab` 또는 `weasyprint` 라이브러리
- HTML → PDF 변환 방식 권장 (스타일 일관성)

**API 엔드포인트**:
```python
POST /api/exam-papers/{exam_id}/export/pdf
Response: FileResponse (application/pdf)
```

**구현 항목**:
1. [ ] PDF 생성 서비스 클래스 생성
2. [ ] 페이지 레이아웃 템플릿 (A4/B4, 1단/2단)
3. [ ] 헤더/푸터 렌더링
4. [ ] 문제 이미지 삽입
5. [ ] 페이지 나눔 로직 (문제가 잘리지 않도록)
6. [ ] 정답지 별도 생성 옵션
7. [ ] 프론트엔드 다운로드 버튼 연결

**예상 소요**: 6-8시간

---

### E-2: 인쇄 최적화 (우선순위: 중간)

**목표**: 브라우저 인쇄 기능 개선

**구현 항목**:
1. [ ] `@media print` CSS 스타일시트 추가
2. [ ] 인쇄 전용 레이아웃 컴포넌트
3. [ ] 페이지 브레이크 제어 (`page-break-before`, `page-break-inside`)
4. [ ] 헤더/푸터 인쇄 숨김
5. [ ] 문제별 페이지 분리 옵션

**예상 소요**: 2-3시간

---

### E-3: HWP/DOCX 내보내기 (우선순위: 낮음)

**목표**: 한글(HWP) 및 Word 문서 내보내기

**기술 옵션**:

| 형식 | 라이브러리 | 난이도 | 품질 |
|------|-----------|--------|------|
| DOCX | `python-docx` | 중 | 좋음 |
| HWP | `pyhwpx` (제한적) | 높음 | 보통 |
| HWP | LibreOffice 변환 | 중 | 좋음 |

**권장 접근**:
1. DOCX 먼저 구현 (python-docx 사용)
2. HWP는 DOCX → HWP 변환 또는 향후 고려

**구현 항목**:
1. [ ] DOCX 생성 서비스
2. [ ] 이미지 삽입 처리
3. [ ] 표/테이블 레이아웃
4. [ ] 스타일 템플릿

**예상 소요**: 8-10시간

---

## Phase F: 미리보기 개선

### F-1: Bulk 문제 조회 API (우선순위: 높음)

**목표**: 미리보기에서 모든 문제를 한 번에 조회

**현재 문제**:
- `problemsMap`이 비어있어 미리보기에서 문제 이미지가 표시되지 않음
- 개별 `useProblem` 훅을 여러 번 호출할 수 없음

**API 엔드포인트**:
```python
POST /api/problems/bulk
Request: { "ids": ["prob1", "prob2", ...] }
Response: { "problems": [...] }
```

**구현 항목**:
1. [ ] 백엔드 bulk 조회 API 추가
2. [ ] 프론트엔드 `useBulkProblems` 훅 생성
3. [ ] ExamPreviewModal에서 훅 사용
4. [ ] 로딩 상태 처리

**예상 소요**: 2-3시간

---

### F-2: 페이지 분할 미리보기 (우선순위: 중간)

**목표**: 실제 인쇄될 페이지 단위로 미리보기

**구현 항목**:
1. [ ] 문제 높이 측정 로직
2. [ ] 페이지별 문제 배치 계산
3. [ ] 페이지 네비게이션 (이전/다음)
4. [ ] 페이지 번호 표시
5. [ ] 페이지 썸네일 사이드바

**예상 소요**: 5-6시간

---

### F-3: 실시간 미리보기 (우선순위: 낮음)

**목표**: 편집과 미리보기 동시 표시

**구현 방식**:
- 2패널 레이아웃 (좌: 편집, 우: 미리보기)
- 또는 분할 화면 토글

**구현 항목**:
1. [ ] 레이아웃 컴포넌트 리팩토링
2. [ ] 미리보기 패널 컴포넌트
3. [ ] 실시간 동기화

**예상 소요**: 4-5시간

---

## Phase G: 통합 워크플로우

### G-1: 문제 검색/필터 개선 (우선순위: 높음)

**목표**: 시험지에 문제 추가 시 효율적인 검색

**현재 AddProblemModal 개선**:
1. [ ] 고급 필터 UI (출처, 유형, 난이도, 단원)
2. [ ] 전문 검색 (문제 내용 검색)
3. [ ] 최근 사용 문제 표시
4. [ ] 즐겨찾기 문제

**예상 소요**: 4-5시간

---

### G-2: 드래그앤드롭 개선 (우선순위: 중간)

**목표**: 문제은행에서 시험지로 직접 드래그

**구현 항목**:
1. [ ] 문제은행 페이지에 드래그 기능 추가
2. [ ] 시험지 편집 페이지를 드롭 존으로
3. [ ] 드래그 중 시각적 피드백
4. [ ] 멀티 선택 드래그

**기술 스택**:
- `@dnd-kit/core` 활용 (이미 사용 중)

**예상 소요**: 5-6시간

---

### G-3: 시험지 복제/템플릿 (우선순위: 중간)

**목표**: 기존 시험지를 복제하거나 템플릿으로 저장

**API 엔드포인트**:
```python
POST /api/exam-papers/{exam_id}/duplicate
POST /api/exam-papers/{exam_id}/save-as-template
GET /api/exam-templates
```

**구현 항목**:
1. [ ] 복제 API 및 서비스
2. [ ] 템플릿 저장/불러오기
3. [ ] 템플릿 관리 UI

**예상 소요**: 4-5시간

---

### G-4: 문제 순서 자동 배열 (우선순위: 낮음)

**목표**: 난이도, 유형별 자동 정렬

**구현 항목**:
1. [ ] 정렬 기준 선택 UI
2. [ ] 난이도순 정렬
3. [ ] 유형별 그룹화
4. [ ] 랜덤 섞기

**예상 소요**: 2-3시간

---

## Phase H: 통계 및 분석

### H-1: 시험지 통계 대시보드 (우선순위: 중간)

**목표**: 시험지 구성 분석

**표시 정보**:
- 총 문제 수, 총점
- 난이도 분포 (파이 차트)
- 유형별 분포
- 단원별 분포
- 예상 풀이 시간

**구현 항목**:
1. [ ] 통계 계산 로직
2. [ ] 차트 컴포넌트 (recharts 사용)
3. [ ] 통계 패널 UI

**예상 소요**: 4-5시간

---

### H-2: 문제 사용 이력 (우선순위: 낮음)

**목표**: 문제가 어느 시험지에서 사용되었는지 추적

**데이터 모델**:
```python
class ProblemUsage:
    problem_id: str
    exam_id: str
    used_at: datetime
```

**구현 항목**:
1. [ ] 사용 이력 저장
2. [ ] 문제 상세에서 사용 이력 표시
3. [ ] 중복 사용 경고

**예상 소요**: 3-4시간

---

### H-3: 시험지 버전 관리 (우선순위: 낮음)

**목표**: 시험지 수정 이력 추적

**구현 항목**:
1. [ ] 버전 스냅샷 저장
2. [ ] 버전 비교
3. [ ] 이전 버전 복원

**예상 소요**: 6-8시간

---

## 구현 우선순위 정리

### 1단계 (필수 - 즉시 진행)
| 작업 | 예상 시간 | 우선순위 |
|------|----------|---------|
| F-1: Bulk 문제 조회 API | 2-3시간 | ⭐⭐⭐ |
| E-1: PDF 내보내기 | 6-8시간 | ⭐⭐⭐ |

### 2단계 (권장 - 1주 내)
| 작업 | 예상 시간 | 우선순위 |
|------|----------|---------|
| E-2: 인쇄 최적화 | 2-3시간 | ⭐⭐ |
| G-1: 문제 검색 개선 | 4-5시간 | ⭐⭐ |
| F-2: 페이지 분할 미리보기 | 5-6시간 | ⭐⭐ |

### 3단계 (선택 - 2주 내)
| 작업 | 예상 시간 | 우선순위 |
|------|----------|---------|
| G-2: 드래그앤드롭 개선 | 5-6시간 | ⭐ |
| G-3: 시험지 복제/템플릿 | 4-5시간 | ⭐ |
| H-1: 통계 대시보드 | 4-5시간 | ⭐ |

### 4단계 (향후 - 1개월 내)
| 작업 | 예상 시간 | 우선순위 |
|------|----------|---------|
| E-3: HWP/DOCX 내보내기 | 8-10시간 | - |
| F-3: 실시간 미리보기 | 4-5시간 | - |
| G-4: 자동 배열 | 2-3시간 | - |
| H-2: 사용 이력 | 3-4시간 | - |
| H-3: 버전 관리 | 6-8시간 | - |

---

## 기술 의존성

### 추가 필요 라이브러리

**백엔드**:
```
reportlab>=4.0.0     # PDF 생성
weasyprint>=60.0     # HTML→PDF (대안)
python-docx>=1.1.0   # DOCX 생성
```

**프론트엔드**:
```
recharts             # 차트 (이미 설치됨)
```

---

## 파일 구조 예상

```
backend/app/
├── services/
│   ├── exam/
│   │   ├── __init__.py
│   │   ├── pdf_exporter.py    # Phase E-1
│   │   ├── docx_exporter.py   # Phase E-3
│   │   └── statistics.py      # Phase H-1
│   └── ...
├── routers/
│   └── exam_papers.py         # 기존 + 내보내기 엔드포인트
└── ...

frontend/src/
├── api/
│   └── examPapers.ts          # + bulk 조회 훅
├── components/
│   └── exam/
│       ├── ExamStatistics.tsx # Phase H-1
│       ├── PagePreview.tsx    # Phase F-2
│       └── ...
└── ...
```

---

## 다음 단계 권장 사항

1. **F-1 먼저 진행**: 미리보기가 제대로 동작하도록 bulk 조회 API 구현
2. **E-1 진행**: PDF 내보내기로 실제 사용 가능한 출력물 생성
3. **사용자 피드백 수집**: 기본 기능 완성 후 추가 요구사항 파악

---

*작성: Claude Code (Opus)*
*날짜: 2025-12-01*

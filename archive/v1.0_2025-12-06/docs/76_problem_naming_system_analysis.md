# 문제 명명 시스템 구현 가능성 분석

**작성일**: 2025-12-03
**요청 사항**:
1. 문제 이름 형식: `시리즈_과정_p페이지_문항번호번` (예: 베이직쎈_공통수학1_p13_3번)
2. 과정 목록 동적 추가 기능

---

## 1. 현재 시스템 분석

### 1.1 데이터 흐름

```
┌─────────────────────────────────────────────────────────────────┐
│ PDF 업로드 (UploadNamingModal)                                  │
├─────────────────────────────────────────────────────────────────┤
│ 입력: 학년(고1), 과정(공통수학1), 시리즈(베이직쎈), 타입(문제)    │
│                          ↓                                      │
│ document_id = "고1_공통수학1_베이직쎈_문제"                       │
│                          ↓                                      │
│ 저장: meta.json (document_id만 저장, 구조화 X)                   │
└─────────────────────────────────────────────────────────────────┘
                           ↓
┌─────────────────────────────────────────────────────────────────┐
│ 그룹 생성 (GroupPanel)                                          │
├─────────────────────────────────────────────────────────────────┤
│ 입력: bookName, course, page, problemNumber                     │
│                          ↓                                      │
│ displayName = "bookName - course, pagep, problemNumber"        │
│ 예: "베이직쎈 - 공통수학1, 13p, 3"                               │
└─────────────────────────────────────────────────────────────────┘
```

### 1.2 현재 저장 구조

**groups.json 예시**:
```json
{
  "problemInfo": {
    "bookName": "베이직쎈",
    "course": "공통수학1",
    "page": 13,
    "problemNumber": "3",
    "displayName": "베이직쎈 - 공통수학1, 13p, 3"
  }
}
```

**원하는 형식**:
```
베이직쎈_공통수학1_p13_3번
```

### 1.3 과정 목록 현황

**위치**: `frontend/src/components/main/UploadNamingModal.tsx`

```typescript
const COURSES: Record<string, string[]> = {
  고1: ['공통수학1', '공통수학2', '수학'],
  고2: ['미적분', '확률과통계', '기하', '수학I', '수학II'],
  고3: ['미적분', '확률과통계', '기하', '수학I', '수학II'],
  중1: ['수학'],
  중2: ['수학'],
  중3: ['수학'],
};
```

**문제점**: 하드코딩되어 동적 추가 불가능

---

## 2. 요청 기능 구현 분석

### 2.1 기능 A: 문제 이름 형식 변경

**현재 형식**:
```
"베이직쎈 - 공통수학1, 13p, 3"
```

**원하는 형식**:
```
"베이직쎈_공통수학1_p13_3번"
```

#### 구현 난이도: ★☆☆☆☆ (매우 쉬움)

#### 수정 위치

| 파일 | 위치 | 변경 내용 |
|------|------|----------|
| `GroupPanel.tsx` | saveEdit 함수 | displayName 생성 로직 |
| `work_sessions.py` | sync_problems_from_groups | 백엔드 displayName 생성 |

#### 수정 코드

**프론트엔드** (`GroupPanel.tsx`):
```typescript
// Before
const displayName =
  `${editForm.bookName} - ${editForm.course || ''}, ${editForm.page}p, ${editForm.problemNumber}`;

// After
const displayName =
  `${editForm.bookName}_${editForm.course}_p${editForm.page}_${editForm.problemNumber}번`;
```

**백엔드** (`work_sessions.py`):
```python
# Before
display_name = f"{display_name}. {problem_number}"

# After
display_name = f"{book_name}_{course}_p{page}_{problem_number}번"
```

#### 고려사항

1. **기존 데이터 호환성**: 이미 저장된 displayName은 이전 형식 유지
2. **빈 필드 처리**: course나 page가 없을 때 처리 필요
3. **특수문자 처리**: 시리즈명에 공백이나 특수문자 있을 경우

---

### 2.2 기능 B: 과정 목록 동적 추가

#### 구현 난이도: ★★★☆☆ (중간)

#### 요구사항 분석

```
현재: 고1 → ['공통수학1', '공통수학2', '수학'] (고정)
원하는 것: 고1 → ['공통수학1', '공통수학2', '수학', '새과정'] (추가 가능)
```

#### 구현 방안 비교

| 방안 | 저장 위치 | 장점 | 단점 |
|------|----------|------|------|
| A: 로컬 설정 파일 | `config/courses.json` | 간단, 서버 재시작 없음 | 배포 복잡 |
| B: 백엔드 API | DB 또는 JSON | 중앙 관리, API로 CRUD | 구현 복잡 |
| C: 브라우저 저장 | localStorage | 즉시 구현 가능 | 브라우저별 분리 |
| **D: 설정 JSON** | `dataset_root/config/` | NAS 동기화, 공유 | 권장 |

#### 권장 방안: D (설정 JSON 파일)

**이유**:
- dataset_root는 이미 NAS 동기화 대상
- 여러 클라이언트가 같은 설정 공유
- 백엔드 구현 간단

#### 구현 구조

**파일**: `dataset_root/config/courses.json`
```json
{
  "version": 1,
  "courses": {
    "고1": ["공통수학1", "공통수학2", "수학"],
    "고2": ["미적분", "확률과통계", "기하", "수학I", "수학II"],
    "고3": ["미적분", "확률과통계", "기하", "수학I", "수학II"],
    "중1": ["수학"],
    "중2": ["수학"],
    "중3": ["수학"]
  },
  "customCourses": {
    "고1": ["사용자추가과정1"],
    "고2": []
  }
}
```

**백엔드 API**:
```
GET  /api/config/courses          # 과정 목록 조회
POST /api/config/courses          # 과정 추가
DELETE /api/config/courses/{id}   # 과정 삭제
```

**프론트엔드**:
- UploadNamingModal에서 API로 과정 목록 조회
- 설정 페이지에서 과정 추가/삭제 UI

---

## 3. 우려사항 및 리스크

### 3.1 데이터 일관성 문제 (중요도: 높음)

**문제**:
- document_id에서 메타데이터 추출 필요
- `"고1_공통수학1_베이직쎈_문제"` → 파싱하여 시리즈, 과정 추출

**위험**:
```
document_id: "고1_공통수학1_2_베이직쎈_문제"
                       ↑ 과정명에 언더스코어가 있으면?
```

**해결책**:
1. **구조화된 메타데이터 저장** (권장)
   ```json
   // meta.json에 추가
   {
     "metadata": {
       "grade": "고1",
       "course": "공통수학1",
       "series": "베이직쎈",
       "type": "문제"
     }
   }
   ```

2. **document_id 파싱 규칙 정의**
   - 마지막 요소 = 타입 (문제/해설)
   - 마지막에서 두번째 = 시리즈
   - 첫번째 = 학년
   - 나머지 = 과정

### 3.2 기존 데이터 마이그레이션 (중요도: 중간)

**영향 범위**:
- 이미 저장된 groups.json의 displayName
- 작업 세션의 ProblemReference.displayName

**해결책**:
- 새 형식은 신규 그룹에만 적용
- 기존 데이터는 그대로 유지 (하위 호환)
- 또는 마이그레이션 스크립트 제공

### 3.3 과정 목록 동기화 (중요도: 중간)

**문제**:
- 여러 사용자가 동시에 과정 추가 시 충돌 가능

**해결책**:
- JSON 파일 잠금 메커니즘
- 또는 append-only 방식 (삭제 제한)

### 3.4 displayName 중복 가능성 (중요도: 낮음)

**문제**:
```
베이직쎈_공통수학1_p13_3번  ← 같은 책의 같은 문제
베이직쎈_공통수학1_p13_3번  ← 중복!
```

**해결책**:
- 문제 저장 시 고유 ID와 함께 저장 (이미 groupId 있음)
- displayName은 표시용, 식별은 groupId로

### 3.5 UI/UX 고려사항 (중요도: 중간)

**현재 그룹 편집 UI**:
```
┌─────────────────────────────────┐
│ 교재명: [베이직쎈        ]      │
│ 과정:   [공통수학1       ]      │
│ 페이지: [13              ]      │
│ 문항:   [3               ]      │
└─────────────────────────────────┘
```

**문제점**:
- 업로드 시 입력한 시리즈/과정이 그룹 생성 시 자동 반영 안 됨
- 매번 수동 입력 필요

**개선 제안**:
- document_id에서 시리즈/과정 자동 추출하여 기본값 설정
- 또는 meta.json에 구조화된 메타데이터 저장

---

## 4. 구현 우선순위 제안

### Phase A: 문제 이름 형식 변경 (즉시 가능)

| 단계 | 작업 | 예상 시간 |
|------|------|----------|
| A-1 | GroupPanel.tsx displayName 형식 변경 | 10분 |
| A-2 | work_sessions.py displayName 형식 변경 | 10분 |
| A-3 | 빈 필드 처리 로직 추가 | 10분 |
| A-4 | 테스트 | 10분 |
| **합계** | | **40분** |

### Phase B: 메타데이터 구조화 (권장)

| 단계 | 작업 | 예상 시간 |
|------|------|----------|
| B-1 | meta.json에 metadata 필드 추가 | 20분 |
| B-2 | 업로드 시 구조화된 메타데이터 저장 | 30분 |
| B-3 | 그룹 생성 시 메타데이터 자동 적용 | 30분 |
| B-4 | 테스트 | 20분 |
| **합계** | | **1시간 40분** |

### Phase C: 과정 동적 추가 (선택)

| 단계 | 작업 | 예상 시간 |
|------|------|----------|
| C-1 | courses.json 설정 파일 생성 | 10분 |
| C-2 | 백엔드 API 구현 (GET/POST) | 40분 |
| C-3 | 프론트엔드 API 연동 | 20분 |
| C-4 | 과정 추가 UI (설정 페이지) | 40분 |
| C-5 | 테스트 | 20분 |
| **합계** | | **2시간 10분** |

---

## 5. 권장 실행 계획

```
┌─────────────────────────────────────────────────────────────────┐
│ 1단계: Phase A (즉시 실행 가능)                                  │
│ - displayName 형식만 변경                                        │
│ - 40분 소요                                                      │
│ - 즉시 효과 확인 가능                                            │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│ 2단계: Phase B (권장)                                            │
│ - 메타데이터 구조화로 자동 기본값 설정                            │
│ - 그룹 생성 시 매번 입력 불필요                                   │
│ - 장기적 데이터 관리에 필수                                       │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│ 3단계: Phase C (선택)                                            │
│ - 새 과정 추가 기능                                              │
│ - 실제 필요 시 구현                                              │
└─────────────────────────────────────────────────────────────────┘
```

---

## 6. 결론

### 구현 가능성: ✅ 높음

| 기능 | 난이도 | 구현 가능성 | 권장도 |
|------|--------|------------|--------|
| 문제 이름 형식 변경 | 쉬움 | ✅ | 즉시 실행 |
| 메타데이터 구조화 | 중간 | ✅ | 강력 권장 |
| 과정 동적 추가 | 중간 | ✅ | 필요시 |

### 주요 우려사항

1. **document_id 파싱 불안정** → 메타데이터 구조화로 해결
2. **기존 데이터 호환** → 신규에만 적용, 점진적 마이그레이션
3. **과정 동기화 충돌** → JSON 파일 관리 방식으로 충분

### 최종 권장

**Phase A만 먼저 실행**하여 즉시 효과를 확인하고,
**Phase B**로 장기적 데이터 구조 개선을 진행하는 것이 좋습니다.

Phase C(과정 추가)는 실제 새 과정이 필요할 때 구현해도 충분합니다.

---

*승인 시 "Phase A 진행해줘"로 실행*

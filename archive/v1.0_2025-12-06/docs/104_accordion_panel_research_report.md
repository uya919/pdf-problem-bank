# 아코디언 페이지 패널 UI 연구 리포트

> Phase 39 | 2025-12-04 | Opus 분석

---

## 1. 현재 상태 분석

### 1.1 현재 UI 구조

```
┌──────────────────────────────────────────────────────────────────────┐
│ 왼쪽 사이드바          │      중앙 캔버스       │  오른쪽 GroupPanel  │
│ (ProblemListPanel)    │                        │                     │
│ ┌───────────────┐     │  ┌─────────────────┐   │  ┌───────────────┐  │
│ │ 미연결 문제 5  │     │  │                 │   │  │ 문제 그룹     │  │
│ │ ○ 3번        │     │  │   PDF 이미지    │   │  │   0개         │  │
│ │ ○ 4번        │     │  │   + 블록 표시   │   │  │               │  │
│ │ ○ 5번        │     │  │                 │   │  │ + 블록을      │  │
│ │ ○ 6번        │     │  │                 │   │  │   선택하세요  │  │
│ │ ○ 7번        │     │  │                 │   │  │               │  │
│ │───────────────│     │  │                 │   │  │ [빈 상태]     │  │
│ │ 매칭 완료   2 │     │  │                 │   │  │               │  │
│ │ ✓ 1번 → R1   │     │  │                 │   │  │               │  │
│ │ ✓ 2번 → R2   │     │  └─────────────────┘   │  └───────────────┘  │
│ └───────────────┘     │                        │                     │
└──────────────────────────────────────────────────────────────────────┘
```

### 1.2 현재 오른쪽 패널 (GroupPanel)의 문제점

| 문제점 | 설명 |
|--------|------|
| **단일 페이지 한정** | 현재 페이지의 그룹만 표시, 전체 진행 상황 파악 불가 |
| **컨텍스트 부족** | 이전/다음 페이지 작업 내용 확인 불가 |
| **페이지 전환 시 초기화** | 페이지 넘기면 그룹 목록이 완전히 바뀜 → 연속성 상실 |
| **작업 이력 부재** | 완료된 페이지 목록을 한눈에 볼 수 없음 |

---

## 2. 사용자 제안 분석

### 2.1 제안된 UI 구조

```
┌─────────────────────────────────────────┐
│  오른쪽 패널 (아코디언 형태)            │
│ ┌─────────────────────────────────────┐ │
│ │ ▼ 현재작업페이지 17p              │ │  ← 펼쳐진 상태 (현재 작업중)
│ │   ┌─────────────────────────────┐   │ │
│ │   │ 1번 베이직쎈_공통수학1_p17  │   │ │
│ │   │ 2번 베이직쎈_공통수학1_p17  │   │ │
│ │   │ 3번 베이직쎈_공통수학1_p17  │   │ │
│ │   │ 4번 (편집중...)             │   │ │
│ │   │ 5번                         │   │ │
│ │   │ 6번                         │   │ │
│ │   │ 7번                         │   │ │
│ │   └─────────────────────────────┘   │ │
│ └─────────────────────────────────────┘ │
│ ┌─────────────────────────────────────┐ │
│ │ ▶ 완료된페이지 10p (7문제) ✓      │ │  ← 접힌 상태
│ └─────────────────────────────────────┘ │
│ ┌─────────────────────────────────────┐ │
│ │ ▶ 완료된페이지 8p (5문제) ✓       │ │  ← 접힌 상태
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

### 2.2 제안의 핵심 개념

| 개념 | 설명 |
|------|------|
| **아코디언 UI** | 섹션별 접기/펼치기 |
| **페이지 단위 그룹핑** | 문제를 페이지별로 묶어서 표시 |
| **작업 이력 스택** | 작업한 페이지가 아래로 쌓임 |
| **현재 페이지 강조** | 현재 작업 페이지는 항상 펼쳐진 상태 |
| **완료 상태 표시** | 완료된 페이지는 체크마크로 구분 |

---

## 3. 토스 UX 철학 적합성 검토

### 3.1 원칙 1: 기본값의 자동화 ✅ 적합

```
┌──────────────────────────────────────────────────────────────┐
│ 현재 작업 페이지가 자동으로 펼쳐짐                            │
│ → 사용자가 "어떤 페이지를 펼칠까" 고민 불필요                 │
│                                                              │
│ 페이지 전환 시 이전 페이지 자동 접힘                          │
│ → 수동으로 접을 필요 없음                                    │
└──────────────────────────────────────────────────────────────┘
```

**평가**: 아코디언 상태 전환이 자동화되어 토스 철학에 부합

### 3.2 원칙 2: 시각적 단순화 ⚠️ 주의 필요

```
장점:
- 현재 페이지 외의 정보는 접혀서 숨겨짐 → 집중도 향상
- 필요할 때만 펼쳐서 볼 수 있음 (Progressive Disclosure)

우려:
- 접힌 상태에서도 "7문제" 같은 숫자가 보이면 정보 과부하
- 아코디언이 많아지면 스크롤이 길어짐
```

**권장**: 접힌 상태는 **페이지번호 + 완료 아이콘**만 표시

```
❌ "완료된페이지 10p (7문제) ✓"
✅ "10p ✓" 또는 "10p · 7"
```

### 3.3 원칙 3: 속도감 ✅ 매우 적합

```
┌──────────────────────────────────────────────────────────────┐
│ 페이지 전환 시 애니메이션:                                   │
│                                                              │
│ 1. 현재 섹션 슬라이드 업 (접히면서)                          │
│ 2. 새 섹션 슬라이드 다운 (펼쳐지면서)                        │
│ 3. 이전 섹션 아래로 이동                                     │
│                                                              │
│ → Optimistic UI: 페이지 전환 버튼 클릭 즉시 애니메이션 시작  │
└──────────────────────────────────────────────────────────────┘
```

**평가**: Framer Motion 기존 사용 → 구현 용이

---

## 4. 구현 가능성 분석

### 4.1 기술적 요구사항

| 요구사항 | 난이도 | 설명 |
|----------|--------|------|
| 아코디언 컴포넌트 | 🟢 쉬움 | Radix UI / HeadlessUI 활용 가능 |
| 다중 페이지 데이터 로드 | 🟡 중간 | TanStack Query로 캐싱 필요 |
| 애니메이션 | 🟢 쉬움 | Framer Motion 이미 사용 중 |
| 상태 관리 | 🟡 중간 | 어떤 페이지가 펼쳐졌는지 추적 |
| 스크롤 동기화 | 🟡 중간 | 현재 섹션이 항상 보이도록 |

### 4.2 데이터 아키텍처

```typescript
// 현재: 단일 페이지 그룹만 로드
const { data: groupsData } = usePageGroups(documentId, currentPage);

// 개선: 다중 페이지 그룹 로드 (작업한 페이지들만)
interface PageGroupSummary {
  pageIndex: number;
  bookPage: number;
  groups: ProblemGroup[];
  isComplete: boolean;  // 모든 문제 확정 여부
}

const { data: allPageGroups } = useAllPageGroups(documentId, visitedPages);
```

### 4.3 컴포넌트 구조

```
AccordionGroupPanel (신규)
├── CurrentPageSection (펼쳐진 상태)
│   └── GroupList (기존 GroupPanel 내부 로직 재사용)
├── CompletedPageSection[] (접힌 상태)
│   └── PageSummary (페이지번호 + 문제수 + 완료상태)
└── ExpandedPageSection? (사용자가 펼친 이전 페이지)
    └── GroupList
```

### 4.4 상태 머신

```
┌─────────────────────────────────────────────────────────────┐
│                     페이지 전환 플로우                        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  [현재 페이지 10p]         페이지 17p로 이동                 │
│       ↓                          ↓                          │
│  ┌─────────────┐           ┌─────────────┐                  │
│  │ 펼쳐진 상태 │  ──────>  │ 접힌 상태   │                  │
│  │ 17p 작업중  │           │ 10p ✓      │                  │
│  └─────────────┘           └─────────────┘                  │
│                                  ↓                          │
│                            스택에 추가                       │
│                                  ↓                          │
│                            ┌─────────────┐                  │
│                            │ 펼쳐진 상태 │                  │
│                            │ 17p 작업중  │                  │
│                            └─────────────┘                  │
└─────────────────────────────────────────────────────────────┘
```

---

## 5. 우려 사항 및 해결책

### 5.1 성능 우려

| 우려 | 영향도 | 해결책 |
|------|--------|--------|
| **다중 페이지 데이터 로드** | 🟡 중간 | 방문한 페이지만 로드 + 캐싱 |
| **아코디언 많아지면 렌더링 부하** | 🟢 낮음 | React.memo + 가상화 (필요시) |
| **애니메이션 프레임 드롭** | 🟢 낮음 | CSS transform 사용 (layout 안 건드림) |

**권장 캐싱 전략**:
```typescript
// 방문한 페이지 목록 관리
const [visitedPages, setVisitedPages] = useState<number[]>([]);

// 페이지 전환 시 목록에 추가
useEffect(() => {
  setVisitedPages(prev =>
    prev.includes(currentPage) ? prev : [...prev, currentPage]
  );
}, [currentPage]);

// TanStack Query로 개별 페이지 캐싱
// staleTime: 5분 → 페이지 재방문 시 캐시 히트
```

### 5.2 UX 우려

| 우려 | 영향도 | 해결책 |
|------|--------|--------|
| **접힌 페이지 클릭하면 어떻게?** | 🟡 중간 | 클릭 시 펼쳐짐 + 해당 페이지로 이동 옵션 |
| **너무 많은 페이지가 쌓이면?** | 🟡 중간 | 최근 10개만 표시 + "더보기" |
| **현재 페이지와 혼동** | 🟢 낮음 | 현재 페이지는 상단 고정 + 다른 색상 배경 |

**접힌 페이지 클릭 동작 제안**:
```
클릭 → 페이지 내용 펼쳐짐 (현재 페이지는 유지)
     → 그 상태에서 그룹 클릭하면 해당 페이지로 이동

또는

클릭 → 즉시 해당 페이지로 이동 + 자동 펼쳐짐
```

### 5.3 데이터 일관성 우려

| 우려 | 영향도 | 해결책 |
|------|--------|--------|
| **페이지 전환 중 저장 안 됨** | 🔴 높음 | 기존 Phase 34-F 로직 유지 (전환 전 자동 저장) |
| **캐시된 데이터와 서버 불일치** | 🟡 중간 | 저장 후 해당 페이지 캐시 무효화 |

**기존 저장 로직 (유지)**:
```typescript
// Phase 34-F: 페이지 변경 전 이전 페이지 그룹 자동 저장
useEffect(() => {
  if (prevPage !== currentPage && prevGroups.length > 0) {
    saveGroupsMutation.mutate({
      documentId,
      pageIndex: prevPage,
      groups: prevGroups,
    });
  }
}, [currentPage, documentId]);
```

---

## 6. 대안 비교

### 6.1 옵션 A: 아코디언 (사용자 제안)

```
장점:
✅ 전체 작업 진행 상황 한눈에 파악
✅ 페이지 간 이동 없이 이전 작업 확인 가능
✅ 자연스러운 작업 이력 흐름

단점:
⚠️ 구현 복잡도 중간
⚠️ 다중 페이지 데이터 관리 필요
```

### 6.2 옵션 B: 탭 UI

```
┌──────────────────────────────────────┐
│ [17p] [10p ✓] [8p ✓] [+]            │
│ ─────────────────────────────────────│
│ 현재 페이지의 그룹 목록              │
└──────────────────────────────────────┘

장점:
✅ 구현 단순
✅ 페이지 전환 명확

단점:
❌ 탭이 많아지면 복잡
❌ 모바일 대응 어려움
```

### 6.3 옵션 C: 타임라인 UI

```
┌──────────────────────────────────────┐
│ 작업 타임라인                        │
│ ────────────────────────────────────│
│ ● 17p 작업중 (7문제)                │
│ │                                   │
│ ● 10p 완료 ✓ (7문제)                │
│ │                                   │
│ ● 8p 완료 ✓ (5문제)                 │
└──────────────────────────────────────┘

장점:
✅ 시간순 작업 흐름 명확
✅ 시각적으로 깔끔

단점:
❌ 상세 정보 표시 어려움
❌ 인터랙션 제한적
```

### 6.4 권장: 옵션 A (아코디언)

**이유**:
1. 토스 UX 철학(Progressive Disclosure)에 가장 부합
2. 기존 GroupPanel 로직 재사용 가능
3. 사용자가 이미 익숙한 UI 패턴
4. 확장성 좋음 (나중에 필터, 검색 추가 가능)

---

## 7. 구현 로드맵

### Phase 39-B: 아코디언 그룹 패널 (예상 작업량)

```
┌──────────────────────────────────────────────────────────────┐
│ Step 1: 데이터 레이어 (30분)                                 │
│ - useVisitedPages 훅 생성                                   │
│ - useMultiPageGroups 훅 생성 (캐싱 전략)                     │
│                                                              │
│ Step 2: UI 컴포넌트 (1시간)                                  │
│ - AccordionGroupPanel 컴포넌트 생성                         │
│ - PageSection 컴포넌트 (펼쳐진/접힌 상태)                    │
│ - 애니메이션 적용 (Framer Motion)                            │
│                                                              │
│ Step 3: 통합 및 테스트 (30분)                                │
│ - PageViewer에 AccordionGroupPanel 연결                      │
│ - 페이지 전환 시 상태 전이 테스트                            │
│ - 저장 로직 검증                                             │
│                                                              │
│ 총 예상: 2시간                                               │
└──────────────────────────────────────────────────────────────┘
```

---

## 8. 결론 및 권고

### 8.1 제안에 대한 평가

| 항목 | 점수 | 평가 |
|------|------|------|
| **UX 개선 효과** | ⭐⭐⭐⭐⭐ | 작업 연속성, 진행 상황 파악 크게 개선 |
| **토스 철학 적합성** | ⭐⭐⭐⭐ | 자동화, Progressive Disclosure 부합 |
| **구현 복잡도** | ⭐⭐⭐ | 중간 (기존 로직 재사용 가능) |
| **성능 영향** | ⭐⭐⭐⭐ | 낮음 (캐싱으로 해결 가능) |

### 8.2 최종 권고

```
┌──────────────────────────────────────────────────────────────┐
│                      ✅ 구현 권장                            │
│                                                              │
│  사용자 제안은 토스 UX 철학에 부합하며,                       │
│  기존 작업 흐름의 연속성 문제를 해결합니다.                   │
│                                                              │
│  우선순위: 높음 (Phase 39-B로 진행)                          │
└──────────────────────────────────────────────────────────────┘
```

### 8.3 구현 시 핵심 원칙

1. **현재 페이지 최우선**: 항상 상단에 펼쳐진 상태로 표시
2. **최소 정보 노출**: 접힌 상태는 "페이지번호 + 완료상태"만
3. **자동 상태 전이**: 사용자 개입 없이 자연스러운 접힘/펼침
4. **기존 저장 로직 유지**: Phase 34-F의 자동 저장 로직 그대로 사용
5. **성능 최적화**: 방문한 페이지만 로드 + 캐싱

---

*리포트 작성: Claude Opus | 2025-12-04*

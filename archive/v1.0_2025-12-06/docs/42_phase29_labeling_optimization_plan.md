# Phase 29: 라벨링 시스템 최적화 상세 개발 계획

**작성일**: 2025-12-03
**기반 문서**:
- [41_labeling_system_audit_report.md](41_labeling_system_audit_report.md)
- [40_phase28_selective_matching_research.md](40_phase28_selective_matching_research.md)

---

## 목표

```
현재: 문제 1개 라벨링 = 30초 (7단계)
목표: 문제 1개 라벨링 = 10초 (3단계)
```

**토스 철학 적용**:
- 자동화 극대화 (AI가 모든 필드 사전 입력)
- 시각적 단순화 (핵심 정보만 표시)
- 속도감 (키보드 중심, Optimistic UI)

---

## 단계별 개발 계획

### Phase 29-A: 코드 정리 (Dead Code 제거)

**예상 시간**: 30분
**위험도**: 🟢 낮음
**의존성**: 없음

#### 작업 내용

| 순서 | 파일 | 조치 | 검증 |
|------|------|------|------|
| 1 | `hooks/useConfirmAction.ts` | 삭제 | grep 검증 완료 |
| 2 | `hooks/useModalState.ts` | 삭제 | grep 검증 완료 |
| 3 | `hooks/index.ts` | export 제거 (있다면) | - |

#### 완료 기준
- [ ] 두 파일 삭제
- [ ] TypeScript 빌드 성공
- [ ] 프론트엔드 정상 동작

---

### Phase 29-B: UI 간소화 - 오프셋 설정 숨김

**예상 시간**: 1시간
**위험도**: 🟢 낮음
**의존성**: 없음

#### 현재 문제
```
┌─────────────────────────────────────────┐
│ [< 이전] [페이지 3/25] [다음 >]        │
│ 오프셋: [___] ← 거의 사용 안됨         │
└─────────────────────────────────────────┘
```

#### 개선 방향
```
┌─────────────────────────────────────────┐
│ [< 이전] [페이지 3/25] [다음 >] [⚙️]   │
└─────────────────────────────────────────┘
              ↓ ⚙️ 클릭 시 펼침
┌─────────────────────────────────────────┐
│ 오프셋 설정: [___]                      │
└─────────────────────────────────────────┘
```

#### 작업 내용

| 순서 | 파일 | 변경 |
|------|------|------|
| 1 | `PageNavigation.tsx` | 오프셋 UI 조건부 렌더링 |
| 2 | `PageNavigation.tsx` | 설정 토글 버튼 추가 |
| 3 | `PageViewer.tsx` | 설정 펼침 상태 관리 (선택적) |

#### 완료 기준
- [ ] 오프셋 설정이 기본적으로 숨겨짐
- [ ] 설정 버튼 클릭 시 표시
- [ ] 기존 기능 정상 동작

---

### Phase 29-C: 그룹 카드 간소화

**예상 시간**: 3시간
**위험도**: 🟡 중간
**의존성**: 없음

#### 현재 문제 (정보 과다)
```
┌───────────────────────────────┐
│ 📦 그룹 1 (3 블록)            │
│ ┌─────────────────────────┐   │
│ │ 교재: 수학의 정석        │   │
│ │ 과정: 고등수학          │   │
│ │ 페이지: 42              │   │
│ │ 문항: 3                 │   │
│ └─────────────────────────┘   │
│ [🔗 연결됨]                    │
│ [✏️ 편집] [🗑️ 삭제] [✅ 확정] │
└───────────────────────────────┘
```

#### 토스 스타일 (핵심만)
```
┌───────────────────────────────┐
│ 3번                      [✅] │ ← 한 줄에 핵심 + 확정
│ 수학의 정석 42p    (3블록)    │ ← 요약 정보
└───────────────────────────────┘
     └→ 클릭하면 상세 편집 모달
```

#### 작업 내용

| 순서 | 파일 | 변경 |
|------|------|------|
| 1 | `GroupPanel.tsx` | 카드 레이아웃 2줄로 간소화 |
| 2 | `GroupPanel.tsx` | 상세 정보 → 클릭 시 모달로 이동 |
| 3 | `GroupPanel.tsx` | 인라인 확정 버튼 (체크 아이콘) |
| 4 | 새 파일 | `GroupEditModal.tsx` 생성 |

#### UI 상세 설계

**기본 상태 (접힘)**
```tsx
<div className="flex items-center justify-between p-3 bg-white rounded-lg border">
  <div className="flex items-center gap-3">
    <span className="font-bold text-lg">3번</span>
    <span className="text-sm text-gray-500">수학의 정석 42p</span>
    <span className="text-xs text-gray-400">(3블록)</span>
  </div>
  <div className="flex items-center gap-2">
    {isConfirmed ? (
      <CheckCircle className="w-5 h-5 text-green-500" />
    ) : (
      <button onClick={onConfirm}>
        <Check className="w-5 h-5 text-gray-400 hover:text-green-500" />
      </button>
    )}
  </div>
</div>
```

**클릭 시 편집 모달**
```
┌────────────────────────────────────┐
│ 문항 정보 편집              [X]   │
├────────────────────────────────────┤
│ 문항번호: [3________]              │
│ 교재명:   [수학의 정석____]        │
│ 과정:     [고등수학______]         │
│ 페이지:   [42___________]          │
│                                    │
│ 블록: 3개 선택됨                   │
│ 연결: 해설 문서 (23p)              │
│                                    │
│      [삭제]           [저장]       │
└────────────────────────────────────┘
```

#### 완료 기준
- [ ] 그룹 카드가 2줄로 축소됨
- [ ] 클릭 시 편집 모달 표시
- [ ] 인라인 확정 버튼 동작
- [ ] 기존 기능 모두 유지

---

### Phase 29-D: 워크플로우 간소화 (7단계 → 3단계)

**예상 시간**: 4시간
**위험도**: 🟡 중간
**의존성**: Phase 29-C

#### 현재 워크플로우 (7단계)
```
1. 블록 드래그 선택
2. G키로 그룹 생성
3. 교재명 입력     ← 수동
4. 과정 입력       ← 수동
5. 페이지 입력     ← 자동
6. 문항번호 입력   ← 자동 제안
7. 확정 버튼 클릭  ← 수동
```

#### 목표 워크플로우 (3단계)
```
1. 블록 드래그 선택
2. G키로 그룹 생성 (모든 필드 자동 입력)
3. Enter로 승인 (또는 수정 후 Enter)
```

#### 자동화 전략

| 필드 | 현재 | 변경 |
|------|------|------|
| 교재명 | 수동 입력 | **문서 설정에서 상속** |
| 과정 | 수동 입력 | **문서 설정에서 상속** |
| 페이지 | 자동 (현재 페이지) | 유지 |
| 문항번호 | 자동 제안 | 유지 |
| 확정 | 수동 클릭 | **Enter 키로 자동** |

#### 작업 내용

| 순서 | 파일 | 변경 |
|------|------|------|
| 1 | `LabelingPage.tsx` | 문서 설정 입력 UI 추가 (최초 1회) |
| 2 | `useDocumentSettings.ts` | 문서별 기본값 저장/로드 |
| 3 | `GroupPanel.tsx` | 그룹 생성 시 기본값 자동 적용 |
| 4 | `GroupPanel.tsx` | Enter 키로 확정 처리 |
| 5 | `PageViewer.tsx` | 키보드 이벤트 연동 |

#### 문서 설정 UI (최초 1회)

```
┌────────────────────────────────────────┐
│ 문서 기본 설정                         │
├────────────────────────────────────────┤
│ 이 설정은 모든 문제에 기본 적용됩니다  │
│                                        │
│ 교재명: [수학의 정석__________]        │
│ 과정:   [고등수학____________]         │
│                                        │
│              [시작하기]                │
└────────────────────────────────────────┘
```

- 첫 라벨링 시작 시 한 번만 표시
- 이후 모든 그룹에 자동 적용
- 개별 그룹에서 수정 가능

#### 완료 기준
- [ ] 문서 설정 UI 동작
- [ ] 그룹 생성 시 기본값 자동 적용
- [ ] Enter 키로 확정 동작
- [ ] 기존 개별 수정 기능 유지

---

### Phase 29-E: 코드 구조 개선 (PageViewer 분리)

**예상 시간**: 6시간
**위험도**: 🔴 높음
**의존성**: Phase 29-A~D 완료 후

#### 현재 문제

`PageViewer.tsx` (755줄) - God Component
```
├── 페이지 상태 관리 (currentPage, navigation)
├── 블록 선택 상태 (selectedBlocks)
├── 그룹 관리 (localGroups, CRUD)
├── 자동 저장 (debounce, save)
├── 매칭 시스템 (session, role, callbacks)
├── 확정 시스템 (confirm, export)
└── 키보드 단축키
```

#### 목표 구조

```
PageViewer.tsx (300줄) - 오케스트레이션만
├── hooks/usePageState.ts      - 페이지 이동, 상태
├── hooks/useBlockSelection.ts - 블록 선택 로직
├── hooks/useGroupManager.ts   - 그룹 CRUD, 저장
├── hooks/useMatchingMode.ts   - 매칭 시스템 래퍼
└── hooks/useConfirmSystem.ts  - 확정 시스템
```

#### 작업 내용

| 순서 | 작업 | 새 파일 |
|------|------|---------|
| 1 | 페이지 상태 분리 | `usePageState.ts` |
| 2 | 블록 선택 분리 | `useBlockSelection.ts` |
| 3 | 그룹 관리 분리 | `useGroupManager.ts` |
| 4 | 매칭 래퍼 생성 | `useMatchingMode.ts` |
| 5 | 확정 시스템 분리 | `useConfirmSystem.ts` |
| 6 | PageViewer 리팩토링 | - |

#### 분리 예시: useBlockSelection.ts

```typescript
interface UseBlockSelectionReturn {
  selectedBlocks: number[];
  selectBlock: (blockId: number, multi?: boolean) => void;
  selectRange: (start: number, end: number) => void;
  clearSelection: () => void;
  isSelected: (blockId: number) => boolean;
}

export function useBlockSelection(): UseBlockSelectionReturn {
  const [selectedBlocks, setSelectedBlocks] = useState<number[]>([]);

  const selectBlock = useCallback((blockId: number, multi = false) => {
    if (multi) {
      setSelectedBlocks(prev =>
        prev.includes(blockId)
          ? prev.filter(id => id !== blockId)
          : [...prev, blockId]
      );
    } else {
      setSelectedBlocks([blockId]);
    }
  }, []);

  // ... 나머지 로직

  return { selectedBlocks, selectBlock, selectRange, clearSelection, isSelected };
}
```

#### 완료 기준
- [ ] 5개 커스텀 훅 생성
- [ ] PageViewer 400줄 이하로 축소
- [ ] 모든 기능 정상 동작
- [ ] TypeScript 빌드 성공

---

### Phase 29-F: 매칭 패널 통합 (선택적)

**예상 시간**: 2시간
**위험도**: 🟢 낮음
**의존성**: 없음

#### 현재 문제 (중복 정보)

```
┌─ 헤더 ───────────────────────────────┐
│ 🟢 매칭 모드 | 문제창 | 대기: 3개    │
└────────────────────────────────────────┘

... (작업 영역) ...

┌─ 플로팅 패널 (우하단) ─────────────────┐
│ 매칭 현황                              │
│ • 완료: 5개                           │
│ • 대기: 3개                           │
│ [상세 보기]                           │
└───────────────────────────────────────┘
```

→ "대기: 3개" 정보가 중복!

#### 개선 방향

```
┌─ 헤더 ───────────────────────────────┐
│ 🟢 매칭 모드 | 문제창 | ✅5 ⏳3      │
└────────────────────────────────────────┘
                          ↑
                     통합된 상태 표시
                     (플로팅 패널 제거)
```

#### 작업 내용

| 순서 | 파일 | 변경 |
|------|------|------|
| 1 | `MatchingHeader.tsx` | 완료/대기 카운트 통합 |
| 2 | `PageViewer.tsx` | MatchingStatusPanel 조건부 렌더링 |
| 3 | 선택적 | MatchingStatusPanel → 상세 모달로 변경 |

#### 완료 기준
- [ ] 헤더에 통합된 상태 표시
- [ ] 플로팅 패널 숨김 또는 제거
- [ ] 상세 정보는 클릭 시 모달로 표시

---

## 전체 로드맵

```
Phase 29-A (30분)     Phase 29-B (1시간)
Dead Code 제거  ────→ 오프셋 숨김
      │                    │
      │                    ↓
      │              Phase 29-C (3시간)
      │              그룹 카드 간소화
      │                    │
      ↓                    ↓
Phase 29-D (4시간) ←───────┘
워크플로우 3단계화
      │
      ↓
Phase 29-E (6시간)      Phase 29-F (2시간)
코드 구조 개선    ─────→ 매칭 패널 통합
                              │
                              ↓
                        ✅ 최적화 완료
```

---

## 예상 총 소요 시간

| Phase | 시간 | 누적 |
|-------|------|------|
| 29-A: Dead Code 제거 | 30분 | 30분 |
| 29-B: 오프셋 숨김 | 1시간 | 1.5시간 |
| 29-C: 그룹 카드 간소화 | 3시간 | 4.5시간 |
| 29-D: 워크플로우 3단계화 | 4시간 | 8.5시간 |
| 29-E: 코드 구조 개선 | 6시간 | 14.5시간 |
| 29-F: 매칭 패널 통합 | 2시간 | 16.5시간 |
| **총계** | **16.5시간** | - |

---

## 성공 지표

### 정량적 목표

| 지표 | 현재 | 목표 | 측정 방법 |
|------|------|------|----------|
| 라벨링 시간/문제 | 30초 | 10초 | 스톱워치 |
| 워크플로우 단계 | 7단계 | 3단계 | 클릭/키 카운트 |
| PageViewer 라인 수 | 755줄 | 400줄 이하 | wc -l |
| 미사용 파일 수 | 2개 | 0개 | grep 검증 |

### 정성적 목표

- [ ] 화면이 "깔끔하다"고 느껴짐
- [ ] Enter 키만으로 빠른 작업 가능
- [ ] 처음 사용자도 3분 내 적응

---

## 위험 요소 및 대응

| 위험 | 확률 | 영향 | 대응 |
|------|------|------|------|
| 29-C에서 기능 누락 | 중 | 높음 | 기존 기능 체크리스트 작성 |
| 29-E 리팩토링 중 버그 | 높 | 중 | 단계별 테스트, git 브랜치 |
| 사용자 적응 문제 | 낮 | 중 | 기존 UI 옵션 유지 |

---

## 체크리스트

### 29-A: Dead Code 제거
- [ ] useConfirmAction.ts 삭제
- [ ] useModalState.ts 삭제
- [ ] 빌드 검증
- [ ] 동작 검증

### 29-B: 오프셋 숨김
- [ ] PageNavigation.tsx 수정
- [ ] 토글 버튼 추가
- [ ] 동작 검증

### 29-C: 그룹 카드 간소화
- [ ] 카드 레이아웃 변경
- [ ] GroupEditModal.tsx 생성
- [ ] 인라인 확정 버튼
- [ ] 기존 기능 테스트

### 29-D: 워크플로우 3단계화
- [ ] 문서 설정 UI
- [ ] 기본값 자동 적용
- [ ] Enter 확정
- [ ] 전체 플로우 테스트

### 29-E: 코드 구조 개선
- [ ] usePageState.ts
- [ ] useBlockSelection.ts
- [ ] useGroupManager.ts
- [ ] useMatchingMode.ts
- [ ] useConfirmSystem.ts
- [ ] PageViewer 리팩토링
- [ ] 빌드 및 동작 검증

### 29-F: 매칭 패널 통합
- [ ] MatchingHeader 통합
- [ ] 플로팅 패널 제거/숨김
- [ ] 상세 모달 (선택적)

---

## 승인 요청

아래 단계 중 진행할 항목을 선택해 주세요:

- [ ] **29-A**: Dead Code 제거 (30분) - 즉시 가능
- [ ] **29-B**: 오프셋 숨김 (1시간)
- [ ] **29-C**: 그룹 카드 간소화 (3시간)
- [ ] **29-D**: 워크플로우 3단계화 (4시간)
- [ ] **29-E**: 코드 구조 개선 (6시간) - 29-A~D 이후 권장
- [ ] **29-F**: 매칭 패널 통합 (2시간) - 선택적

**권장**: 29-A → 29-B → 29-C → 29-D 순서로 진행

---

*작성일: 2025-12-03*
*Phase 29: 라벨링 시스템 최적화*

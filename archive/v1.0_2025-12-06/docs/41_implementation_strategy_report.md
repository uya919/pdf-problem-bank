# 구현 전략 리포트: 학원 맞춤형 수학 문제은행 시스템

**작성일**: 2025-12-02
**문서 유형**: 전략적 의사결정 리포트
**목적**: 구현 가능성 분석 + 큰 그림 제시 → 승인 후 상세 계획 수립

---

## Executive Summary (핵심 요약)

### 현재 상태
우리는 **3개의 핵심 자산**을 보유하고 있습니다:
- PDF 라벨링 시스템 (블록 검출 + 그룹핑)
- HML 파서 (한글 2007-2020 지원)
- HWPX 파서 (한글 2022+ 지원)

### 기회
Gemini 리포트 분석 결과, **토스(Toss) UX 철학**을 적용하면:
- 작업 속도 **5~10배** 향상 가능
- 학원 경쟁력 있는 **차별화된 도구** 구축 가능

### 제안
**3단계 점진적 구현** 전략을 권장합니다:

| 단계 | 범위 | 예상 효과 | 위험도 |
|------|------|----------|--------|
| **Foundation** | UI/UX 리디자인 | 체감 품질 ↑↑ | 낮음 |
| **Intelligence** | 자동 태깅 + 검색 | 작업 속도 ↑↑↑ | 중간 |
| **Platform** | 학습지 빌더 | 완결성 확보 | 높음 |

---

## Part 1: 큰 그림 (The Big Picture)

### 1.1 비전: "10초 안에 완료되는 문제 등록"

```
┌─────────────────────────────────────────────────────────────────────┐
│                         현재 워크플로우                              │
│  ┌────────┐   ┌────────┐   ┌────────┐   ┌────────┐   ┌────────┐    │
│  │ PDF    │ → │ 캡처   │ → │ 분류   │ → │ 태깅   │ → │ 저장   │    │
│  │ 열기   │   │ (수동) │   │ (수동) │   │ (수동) │   │        │    │
│  └────────┘   └────────┘   └────────┘   └────────┘   └────────┘    │
│      ↓            ↓            ↓            ↓            ↓         │
│    30초         3분          2분          2분         30초         │
│                                                                     │
│                    총 소요 시간: 약 8분/문제                        │
└─────────────────────────────────────────────────────────────────────┘

                              ▼ ▼ ▼

┌─────────────────────────────────────────────────────────────────────┐
│                         목표 워크플로우                              │
│  ┌────────────────────────────────────────────────────────────────┐ │
│  │                    파일 드래그 앤 드롭                          │ │
│  └──────────────────────────┬─────────────────────────────────────┘ │
│                             ▼                                       │
│  ┌──────────────────────────────────────────────────────────────┐   │
│  │  AI 자동 처리 (백그라운드)                                    │   │
│  │  • 문제 분할 (자동)                                          │   │
│  │  • 수식 추출 (자동)                                          │   │
│  │  • 단원 분류 (자동)                                          │   │
│  │  • 난이도 예측 (자동)                                        │   │
│  └──────────────────────────┬───────────────────────────────────┘   │
│                             ▼                                       │
│  ┌────────────────────────────────────────────────────────────────┐ │
│  │  사용자: 승인만 (Enter 키)                                     │ │
│  │  "이차함수 > 최대최소 > 중상" ✓                                │ │
│  └────────────────────────────────────────────────────────────────┘ │
│                                                                     │
│                    총 소요 시간: 약 10초/문제                       │
└─────────────────────────────────────────────────────────────────────┘
```

### 1.2 시스템 아키텍처 전체 조감도

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              입력 계층 (Input Layer)                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │
│  │    PDF      │  │    HML      │  │    HWPX     │  │   이미지    │        │
│  │  (기존✓)    │  │  (기존✓)    │  │  (기존✓)    │  │  (신규)     │        │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘        │
│         │                │                │                │               │
│         └────────────────┴────────────────┴────────────────┘               │
│                                   │                                         │
│                                   ▼                                         │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
┌─────────────────────────────────────────────────────────────────────────────┐
│                           처리 계층 (Processing Layer)                       │
│                                   │                                         │
│                                   ▼                                         │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                    통합 문제 추출기 (Unified Extractor)              │   │
│  │  • PDF → DensityAnalyzer (기존✓)                                    │   │
│  │  • HML → ENDNOTE Parser (기존✓)                                     │   │
│  │  • HWPX → ZIP/XML Parser (기존✓)                                    │   │
│  └─────────────────────────────────┬───────────────────────────────────┘   │
│                                    │                                        │
│                                    ▼                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                    정규화 파이프라인 (Normalizer)                    │   │
│  │  • 수식 → LaTeX 통일 (신규)                                         │   │
│  │  • 이미지 → Base64/URL 통일 (부분 기존)                             │   │
│  │  • 텍스트 → 형태소 분석 (신규)                                      │   │
│  └─────────────────────────────────┬───────────────────────────────────┘   │
│                                    │                                        │
│                                    ▼                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                    지능 계층 (Intelligence Layer)                    │   │
│  │  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐            │   │
│  │  │  자동 태깅    │  │  벡터 임베딩  │  │  중복 탐지    │            │   │
│  │  │  (LLM 기반)   │  │  (유사 검색)  │  │  (코사인)     │            │   │
│  │  │  [신규]       │  │  [신규]       │  │  [신규]       │            │   │
│  │  └───────────────┘  └───────────────┘  └───────────────┘            │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
┌─────────────────────────────────────────────────────────────────────────────┐
│                              저장 계층 (Storage Layer)                       │
│                                   │                                         │
│                                   ▼                                         │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                         문제 데이터베이스                            │   │
│  │  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐            │   │
│  │  │  문제 테이블  │  │  분류 테이블  │  │  벡터 인덱스  │            │   │
│  │  │  (기존 확장)  │  │  (기존✓)      │  │  [신규]       │            │   │
│  │  └───────────────┘  └───────────────┘  └───────────────┘            │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
┌─────────────────────────────────────────────────────────────────────────────┐
│                           프레젠테이션 계층 (UI Layer)                       │
│                                   │                                         │
│                                   ▼                                         │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │                        토스 스타일 UI 시스템                           │ │
│  │                                                                        │ │
│  │   ┌─────────────┐   ┌─────────────┐   ┌─────────────┐                 │ │
│  │   │  피드형     │   │  학습지     │   │  분석       │                 │ │
│  │   │  검수 UI    │   │  빌더       │   │  대시보드   │                 │ │
│  │   │  [신규]     │   │  [신규]     │   │  [신규]     │                 │ │
│  │   └─────────────┘   └─────────────┘   └─────────────┘                 │ │
│  │                                                                        │ │
│  │   공통 컴포넌트: 버튼, 카드, 입력, 모달, 토스트 [신규]                 │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## Part 2: 구현 가능성 분석 (Feasibility Analysis)

### 2.1 자산 현황 (What We Have)

#### 핵심 자산 상세

| 자산 | 완성도 | 강점 | 약점 | 재사용 가치 |
|------|--------|------|------|-------------|
| **PDF 라벨링** | 85% | DensityAnalyzer 정확도, Progressive Processing | UI 올드함 | ★★★★★ |
| **HML 파서** | 90% | ENDNOTE 완벽 지원, 수식/이미지 추출 | 일부 특수 케이스 | ★★★★★ |
| **HWPX 파서** | 90% | ZIP 구조 활용, 표 셀 병합 완벽 | 구버전 미지원 | ★★★★★ |
| **분류 체계** | 95% | 수학비서 5단계 트리, 847개 노드 | - | ★★★★★ |

#### 코드베이스 품질

```python
# 현재 코드베이스 강점
- 타입 힌트 완벽 적용 (Python 3.11+)
- Pydantic 모델 기반 데이터 검증
- 싱글톤 패턴으로 리소스 관리
- React + TypeScript 프론트엔드

# 개선 필요 사항
- UI 컴포넌트 일관성 부족
- 상태 관리 복잡도
- 테스트 커버리지 낮음
```

### 2.2 Gemini 제안 vs 현실적 구현 (Gap Analysis)

| Gemini 제안 | 이상적 구현 | 현실적 구현 | Gap | 판단 |
|-------------|-------------|-------------|-----|------|
| **Mathpix OCR** | 수식 인식 최고 정확도 | 우리 HML/HWPX 파서로 대체 | 없음 | ✅ 불필요 |
| **Next.js 15 + Supabase** | 풀스택 교체 | FastAPI + React 유지 | 스택 변경 | ⚠️ 유지 권장 |
| **pgvector 벡터 검색** | PostgreSQL 전환 | SQLite + 파이썬 벡터 라이브러리 | DB 전환 | 🔄 선택적 |
| **LLM 자동 태깅** | Claude/GPT API 호출 | 동일하게 구현 가능 | 없음 | ✅ 구현 가능 |
| **토스 스타일 UI** | 디자인 시스템 전면 교체 | Tailwind + 점진적 적용 | 시간 | ✅ 구현 가능 |
| **피드형 검수 UI** | 인스타그램 스타일 | React 컴포넌트로 구현 | 없음 | ✅ 구현 가능 |
| **학습지 빌더** | 드래그 앤 드롭 조합 | react-dnd 활용 | 복잡도 | ⚠️ 후순위 |

### 2.3 기술적 의존성 맵

```
┌─────────────────────────────────────────────────────────────────┐
│                     의존성 다이어그램                            │
│                                                                  │
│   [Foundation]                                                   │
│        │                                                         │
│        ├── Tailwind CSS 설정 ────────────────────────────┐      │
│        │                                                  │      │
│        ├── 디자인 토큰 정의 ──────────────────────────┐   │      │
│        │                                              │   │      │
│        └── 공통 컴포넌트 ─────────────────────────┐   │   │      │
│                                                   │   │   │      │
│   [Intelligence]                                  │   │   │      │
│        │                                          ▼   ▼   ▼      │
│        ├── LaTeX 정규화 ─────────────────► 피드형 검수 UI       │
│        │                                          │              │
│        ├── LLM 태깅 API ─────────────────► 자동 태그 표시       │
│        │                                          │              │
│        └── 벡터 임베딩 ──────────────────► 중복 경고 UI         │
│                                                   │              │
│   [Platform]                                      ▼              │
│        │                                                         │
│        └── 학습지 빌더 ◄────────────── (검수 완료된 문제)       │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘

의존성 순서:
1. Foundation (UI 기반) → 2. Intelligence (AI 기능) → 3. Platform (응용)
```

---

## Part 3: 구현 모듈 정의 (Approval Required)

### 모듈 A: Foundation Layer (UI 기반)

#### A-1: 토스 스타일 디자인 시스템

**범위**:
- Tailwind CSS v4 설정
- 컬러 토큰 (Toss Blue, Cool Greys)
- 타이포그래피 (Pretendard)
- 스페이싱 시스템 (4px 그리드)

**구현 난이도**: ⭐⭐ (낮음)
**예상 소요**: 2-3일
**위험도**: 낮음

**결과물**:
```css
/* tailwind.config.ts에 추가될 디자인 토큰 */
colors: {
  toss: { blue: '#3182F6' },
  grey: { 50, 100, 200, 300, 500, 700, 900 }
}
```

**승인 여부**: [ ] 승인 / [ ] 보류 / [ ] 거부

---

#### A-2: 공통 컴포넌트 라이브러리

**범위**:
- Button (Primary, Secondary, Ghost)
- Card (문제 카드, 정보 카드)
- Input (검색, 태그 입력)
- Modal (확인, 경고)
- Toast (성공, 에러, 정보)
- Badge (난이도, 단원)

**구현 난이도**: ⭐⭐⭐ (중간)
**예상 소요**: 3-5일
**위험도**: 낮음

**결과물**:
```tsx
// 예시: TossButton 컴포넌트
<TossButton variant="primary" onClick={handleClick}>
  문제 등록
</TossButton>
```

**승인 여부**: [ ] 승인 / [ ] 보류 / [ ] 거부

---

#### A-3: 애니메이션 시스템 (Framer Motion)

**범위**:
- Spring 물리 상수 정의
- 클릭 애니메이션 (scale 0.96)
- 페이지 전환 애니메이션
- 리스트 stagger 효과

**구현 난이도**: ⭐⭐⭐ (중간)
**예상 소요**: 2-3일
**위험도**: 낮음

**결과물**:
```tsx
// 모든 버튼에 적용될 기본 애니메이션
const springTransition = { type: "spring", stiffness: 400, damping: 30 };
```

**승인 여부**: [ ] 승인 / [ ] 보류 / [ ] 거부

---

### 모듈 B: Intelligence Layer (AI 기능)

#### B-1: LaTeX 정규화 파이프라인

**범위**:
- HML/HWPX에서 추출된 수식 통일
- 공백, 명령어 정규화
- 렌더링 검증 (KaTeX)

**구현 난이도**: ⭐⭐⭐ (중간)
**예상 소요**: 3-4일
**위험도**: 중간 (엣지 케이스 존재)

**결과물**:
```python
def normalize_latex(raw: str) -> str:
    """
    입력: x^{2} + y^{2} = 1
    출력: x^2+y^2=1 (정규화)
    """
```

**승인 여부**: [ ] 승인 / [ ] 보류 / [ ] 거부

---

#### B-2: LLM 기반 자동 태깅

**범위**:
- Claude API 연동
- 프롬프트 설계 (단원 분류, 난이도 예측)
- 분류 체계 JSON 컨텍스트
- 결과 파싱 및 검증

**구현 난이도**: ⭐⭐⭐⭐ (높음)
**예상 소요**: 5-7일
**위험도**: 중간 (프롬프트 튜닝 필요)

**API 비용 추정**:
- Claude 3.5 Sonnet: ~$0.003/문제
- 1000문제 처리: ~$3

**결과물**:
```python
async def auto_tag(problem_text: str, problem_image: str) -> TagResult:
    """
    반환값:
    {
        "grade": "고등수학(상)",
        "major_unit": "다항식",
        "middle_unit": "다항식의 연산",
        "minor_unit": "다항식의 덧셈과 뺄셈",
        "difficulty": 3,
        "confidence": 0.92
    }
    """
```

**승인 여부**: [ ] 승인 / [ ] 보류 / [ ] 거부

---

#### B-3: 벡터 검색 및 중복 탐지

**범위**:
- 문제 텍스트 임베딩 (OpenAI 또는 로컬 모델)
- 코사인 유사도 검색
- 중복 임계값 설정 (0.95)
- 유사 문제 추천

**구현 난이도**: ⭐⭐⭐⭐ (높음)
**예상 소요**: 5-7일
**위험도**: 중간 (DB 구조 변경 필요)

**기술 선택지**:
| 옵션 | 장점 | 단점 |
|------|------|------|
| OpenAI Embedding | 고품질, 간단 | API 비용 |
| sentence-transformers | 무료, 로컬 | 설정 복잡 |
| 하이브리드 | 균형 | 구현 복잡 |

**승인 여부**: [ ] 승인 / [ ] 보류 / [ ] 거부

---

### 모듈 C: Application Layer (응용 기능)

#### C-1: 피드형 검수 UI

**범위**:
- 카드 기반 문제 표시
- 키보드 단축키 (Enter=승인, E=편집, T=태그)
- Optimistic UI 업데이트
- 진행률 표시

**구현 난이도**: ⭐⭐⭐⭐ (높음)
**예상 소요**: 5-7일
**위험도**: 중간

**핵심 UX**:
```
┌────────────────────────────────────────────────────────┐
│  문제 검수 (12/45)                          ⌘K 검색   │
├────────────────────────────────────────────────────────┤
│                                                        │
│   ┌──────────────────────────────────────────────┐    │
│   │                                              │    │
│   │         [문제 이미지]                        │    │
│   │                                              │    │
│   │    x² + 2x + 1 = 0 을 풀어라                │    │
│   │                                              │    │
│   └──────────────────────────────────────────────┘    │
│                                                        │
│   AI 제안:                                             │
│   ┌─────────┐ ┌─────────────┐ ┌────────┐              │
│   │ 고등수학 │ │ 이차방정식  │ │ 난이도3 │              │
│   └─────────┘ └─────────────┘ └────────┘              │
│                                                        │
│   ┌────────────────┐  ┌────────────────┐              │
│   │    ✓ 승인      │  │    ✎ 수정      │              │
│   │   (Enter)      │  │     (E)        │              │
│   └────────────────┘  └────────────────┘              │
│                                                        │
└────────────────────────────────────────────────────────┘
```

**승인 여부**: [ ] 승인 / [ ] 보류 / [ ] 거부

---

#### C-2: 통합 파일 업로드 UI

**범위**:
- 드래그 앤 드롭 영역
- PDF/HML/HWPX 자동 감지
- 처리 진행률 표시
- 에러 핸들링

**구현 난이도**: ⭐⭐⭐ (중간)
**예상 소요**: 3-4일
**위험도**: 낮음

**승인 여부**: [ ] 승인 / [ ] 보류 / [ ] 거부

---

#### C-3: 학습지 빌더 (선택적)

**범위**:
- 문제 선택 및 조합
- 드래그 앤 드롭 순서 변경
- A4 레이아웃 미리보기
- PDF 내보내기

**구현 난이도**: ⭐⭐⭐⭐⭐ (매우 높음)
**예상 소요**: 10-14일
**위험도**: 높음 (복잡한 상태 관리)

**권장**: 후순위 (Phase 2 이후)

**승인 여부**: [ ] 승인 / [ ] 보류 / [ ] 거부

---

### 모듈 D: 기존 기능 정리

#### D-1: 유지할 핵심 기능

| 기능 | 현재 위치 | 변경 사항 |
|------|----------|-----------|
| PDF 라벨링 | `/pdf` 라우터 | UI 리디자인만 |
| HML 파서 | `hangul/hml_parser.py` | 유지 |
| HWPX 파서 | `hangul/hwpx_parser.py` | 유지 |
| 분류 체계 | `classification/` | 유지 |
| 블록 검출 | `density_analyzer.py` | 유지 |

#### D-2: 제거할 기능

| 기능 | 이유 |
|------|------|
| (사용자 지정) | 불필요하다고 판단되는 기능 목록 필요 |

**승인 여부**: [ ] 목록 확인 후 승인

---

## Part 4: 구현 로드맵 (Roadmap)

### 권장 순서

```
Week 1-2: Foundation
├── A-1: 디자인 시스템 (2-3일)
├── A-2: 공통 컴포넌트 (3-5일)
└── A-3: 애니메이션 (2-3일)

Week 3-4: Intelligence
├── B-1: LaTeX 정규화 (3-4일)
├── B-2: LLM 자동 태깅 (5-7일)
└── B-3: 벡터 검색 (5-7일)  ← 선택적

Week 5-6: Application
├── C-1: 피드형 검수 UI (5-7일)
├── C-2: 통합 업로드 UI (3-4일)
└── C-3: 학습지 빌더 (10-14일)  ← 후순위
```

### MVP (최소 기능 제품) 정의

**필수 기능** (MVP에 포함):
- [ ] 디자인 시스템 (A-1)
- [ ] 공통 컴포넌트 (A-2)
- [ ] LLM 자동 태깅 (B-2)
- [ ] 피드형 검수 UI (C-1)
- [ ] 통합 업로드 UI (C-2)

**선택 기능** (MVP 이후):
- [ ] 애니메이션 시스템 (A-3)
- [ ] LaTeX 정규화 (B-1)
- [ ] 벡터 검색 (B-3)
- [ ] 학습지 빌더 (C-3)

---

## Part 5: 위험 요소 및 대응 방안

### 5.1 기술적 위험

| 위험 | 확률 | 영향 | 대응 |
|------|------|------|------|
| LLM 응답 품질 불안정 | 중 | 중 | 프롬프트 버전 관리, fallback 로직 |
| 벡터 DB 성능 이슈 | 낮 | 높 | 인덱싱 최적화, 캐싱 |
| UI 컴포넌트 충돌 | 중 | 낮 | Tailwind 클래스 네이밍 규칙 |

### 5.2 비용 위험

| 항목 | 월 예상 비용 | 비고 |
|------|-------------|------|
| Claude API | $10-30 | 문제 수에 비례 |
| OpenAI Embedding | $5-15 | 벡터 검색 사용 시 |
| 인프라 | $0 | 로컬 개발 기준 |

### 5.3 일정 위험

- **낙관적**: 4주
- **현실적**: 6주
- **비관적**: 8주 (예상치 못한 이슈 발생 시)

---

## Part 6: 의사결정 체크리스트

### 승인 필요 항목

**Foundation Layer**:
- [ ] A-1: 토스 스타일 디자인 시스템
- [ ] A-2: 공통 컴포넌트 라이브러리
- [ ] A-3: 애니메이션 시스템

**Intelligence Layer**:
- [ ] B-1: LaTeX 정규화 파이프라인
- [ ] B-2: LLM 기반 자동 태깅
- [ ] B-3: 벡터 검색 및 중복 탐지

**Application Layer**:
- [ ] C-1: 피드형 검수 UI
- [ ] C-2: 통합 파일 업로드 UI
- [ ] C-3: 학습지 빌더 (후순위)

**기존 기능**:
- [ ] D-1: 유지할 기능 목록 확인
- [ ] D-2: 제거할 기능 목록 확정

---

## 결론

### 핵심 제안

1. **점진적 접근**: Foundation → Intelligence → Application 순서로 구현
2. **MVP 집중**: 핵심 5개 모듈에 집중 (A-1, A-2, B-2, C-1, C-2)
3. **기존 자산 활용**: PDF/HML/HWPX 파서는 그대로 유지, UI만 개선
4. **위험 관리**: LLM 의존도 조절 (fallback 로직)

### 다음 단계

승인된 모듈에 대해 **상세 개발 계획**을 수립합니다:
- 일별 작업 계획
- 파일별 변경 사항
- 테스트 기준
- 완료 조건

---

*이 리포트에서 승인할 모듈을 선택해 주세요.*
*승인된 모듈에 대해서만 상세 개발 계획을 작성합니다.*

---

**작성**: Claude Code
**문서 버전**: 1.0
**최종 업데이트**: 2025-12-02

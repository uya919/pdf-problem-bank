# Phase 34.5 연구 리포트: 파일명 규칙과 파싱

> **작성일**: 2025-12-03
> **상태**: 연구 완료
> **작성자**: Claude Code (Opus)

---

## 1. 문제 요약

### 증상
파일을 업로드했는데 "전체 찾아보기"에 표시되지 않음

### 원인
**업로드된 파일명이 파싱 규칙과 맞지 않음**

---

## 2. 현재 파싱 규칙 분석

### 2.1 지원하는 패턴

#### 패턴 1: 4파트 (학년_과정_시리즈_타입)
```
정규식: /^([초중고][1-6]?)_(.+?)_(.+?)_(문제|해설)$/
```

**예시:**
```
✅ 고1_공통수학1_수학의바이블_문제.pdf
✅ 중2_수학_개념원리_해설.pdf
✅ 초6_수학_쎈_문제.pdf
```

#### 패턴 2: 3파트 (학년_시리즈_타입)
```
정규식: /^([초중고][1-6]?)_(.+?)_(문제|해설)$/
과정은 자동으로 "수학"
```

**예시:**
```
✅ 고1_수학의바이블_문제.pdf
✅ 중3_개념원리_해설.pdf
```

### 2.2 파싱 요구사항

| 요소 | 규칙 | 예시 |
|------|------|------|
| **학년** | `초`, `중`, `고` + 숫자(1-6) | `고1`, `중2`, `초6` |
| **구분자** | 언더스코어 `_` | - |
| **타입** | `문제` 또는 `해설` | - |
| **확장자** | `.pdf` (대소문자 무관) | - |

---

## 3. 현재 업로드된 파일 분석

### 3.1 실제 파일 목록

```json
[
  "251201_251201 중1 기초반 test_문제지",
  "베이직쎈+고등+공통수학1해설",
  "베이직쎈 공통수학1 문제_250527_194013 (1)"
]
```

### 3.2 파싱 실패 원인

| 파일명 | 실패 원인 |
|--------|----------|
| `251201_251201 중1 기초반 test_문제지` | ❌ 숫자로 시작 (날짜), `문제지` ≠ `문제` |
| `베이직쎈+고등+공통수학1해설` | ❌ 시리즈로 시작, `_` 구분자 없음 |
| `베이직쎈 공통수학1 문제_250527_194013 (1)` | ❌ 시리즈로 시작, 날짜 포함 |

### 3.3 파싱 시뮬레이션

```javascript
parseDocumentName("251201_251201 중1 기초반 test_문제지")
// 결과: { grade: null, course: null, series: null, type: null }
// 이유: "초/중/고"로 시작하지 않음

parseDocumentName("베이직쎈+고등+공통수학1해설")
// 결과: { grade: null, course: null, series: null, type: null }
// 이유: "초/중/고"로 시작하지 않음

parseDocumentName("베이직쎈 공통수학1 문제_250527_194013 (1)")
// 결과: { grade: null, course: null, series: null, type: null }
// 이유: "초/중/고"로 시작하지 않음
```

---

## 4. 올바른 파일명 형식

### 4.1 추천 파일명 형식

```
{학년}_{과정}_{시리즈}_{문제|해설}.pdf
```

### 4.2 올바른 예시

| 현재 파일명 | 권장 파일명 |
|-------------|-------------|
| `251201_251201 중1 기초반 test_문제지` | `중1_기초반_test_문제.pdf` |
| `베이직쎈+고등+공통수학1해설` | `고1_공통수학1_베이직쎈_해설.pdf` |
| `베이직쎈 공통수학1 문제_250527_194013 (1)` | `고1_공통수학1_베이직쎈_문제.pdf` |

### 4.3 학년 코드표

| 학교급 | 코드 |
|--------|------|
| 초등학교 | `초3`, `초4`, `초5`, `초6` |
| 중학교 | `중1`, `중2`, `중3` |
| 고등학교 | `고1`, `고2`, `고3` |

### 4.4 타입 코드

| 타입 | 코드 |
|------|------|
| 문제집 | `문제` |
| 해설집 | `해설` |

---

## 5. 완비 조합 (Complete Combo)

### 5.1 완비 조합이란?

**문제 + 해설**이 모두 있는 조합

```
고1_공통수학1_수학의바이블_문제.pdf  ← 문제
고1_공통수학1_수학의바이블_해설.pdf  ← 해설
                    ↓
            완비 조합 (isComplete: true)
```

### 5.2 완비 조합만 세션 시작 가능

현재 HeroSection.tsx에서:
```typescript
if (!combo.problemDocId || !combo.solutionDocId) {
  alert(`${combo.series}의 문제 또는 해설 파일이 없습니다.`);
  return;
}
```

---

## 6. 테스트용 파일명 예시

### 6.1 최소 테스트 세트

```
고1_공통수학1_테스트_문제.pdf
고1_공통수학1_테스트_해설.pdf
```

### 6.2 실제 교재 예시

```
# 고등학교
고1_공통수학1_수학의바이블_문제.pdf
고1_공통수학1_수학의바이블_해설.pdf
고1_공통수학1_개념원리_문제.pdf
고1_공통수학1_개념원리_해설.pdf
고2_미적분_블랙라벨_문제.pdf
고2_미적분_블랙라벨_해설.pdf

# 중학교
중1_수학_개념원리_문제.pdf
중1_수학_개념원리_해설.pdf
중2_수학_쎈_문제.pdf
중2_수학_쎈_해설.pdf

# 간단한 형식 (3파트)
고1_수학의바이블_문제.pdf    → 과정: "수학" (자동)
고1_수학의바이블_해설.pdf
```

---

## 7. 해결 방안

### 방안 A: 파일명 변경 (권장)

기존 파일을 규칙에 맞게 이름 변경:

```
베이직쎈+고등+공통수학1해설
  → 고1_공통수학1_베이직쎈_해설.pdf

베이직쎈 공통수학1 문제_250527_194013 (1)
  → 고1_공통수학1_베이직쎈_문제.pdf
```

### 방안 B: 파서 확장 (비권장)

다양한 파일명 패턴을 지원하도록 파서 수정.

**비권장 이유:**
- 너무 많은 예외 케이스
- 파싱 정확도 저하
- 유지보수 어려움

### 방안 C: 업로드 시 이름 입력 UI (향후)

업로드 시 학년/과정/시리즈/타입을 선택하는 UI 추가.
→ Phase 35 이후 고려

---

## 8. 체크리스트

### 파일 업로드 전 확인사항

- [ ] 파일명이 `학년_` 으로 시작하는가? (예: `고1_`, `중2_`)
- [ ] 언더스코어 `_` 로 구분되어 있는가?
- [ ] 마지막이 `_문제` 또는 `_해설` 인가?
- [ ] 확장자가 `.pdf` 인가?
- [ ] 문제와 해설 파일이 쌍으로 있는가?

---

## 9. 결론

### 핵심 포인트

1. **현재 파일명이 규칙에 맞지 않음** → 파싱 실패 → 목록에 안 보임
2. **파일명 형식**: `{학년}_{과정}_{시리즈}_{문제|해설}.pdf`
3. **학년 코드**: `초3-6`, `중1-3`, `고1-3`
4. **타입**: `문제` 또는 `해설` (정확히!)

### 즉시 조치

기존 파일 이름을 규칙에 맞게 변경:
```
고1_공통수학1_베이직쎈_문제.pdf
고1_공통수학1_베이직쎈_해설.pdf
```

---

*리포트 작성: Claude Code (Opus)*
*최종 업데이트: 2025-12-03*

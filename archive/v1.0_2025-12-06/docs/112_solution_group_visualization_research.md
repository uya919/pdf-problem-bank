# 연구 리포트: 해설 그룹 시각화 기능

> 2025-12-04 | Phase 42 연구

---

## 1. 요청 요약

| 항목 | 내용 |
|------|------|
| **현재 상태** | 해설 연결 시 그룹이 생성되지만 UI에서 잘 보이지 않음 |
| **원하는 기능** | 문제 그룹처럼 해설 그룹도 캔버스에 시각적으로 표시 |
| **참고 이미지** | 문제 탭의 그룹핑 박스 (1번, 4번 같은 파란/보라 테두리) |

---

## 2. 현재 시스템 분석

### 2.1 해설 그룹 생성 흐름

```
┌─────────────────────────────────────────────────────────────┐
│ 1. 해설 탭에서 블록 선택 + G키                               │
└──────────────────┬──────────────────────────────────────────┘
                   │
                   ▼
┌─────────────────────────────────────────────────────────────┐
│ 2. PageViewer.handleCreateGroup()                           │
│    - newGroup 생성 (id, block_ids, status: 'confirmed')    │
│    - localGroups에 추가                                     │
│    - onGroupCreated 콜백 호출                               │
└──────────────────┬──────────────────────────────────────────┘
                   │
           ┌───────┴───────┐
           │               │
           ▼               ▼
┌─────────────────┐  ┌──────────────────────────────────────┐
│ 3a. saveGroups  │  │ 3b. UnifiedWorkPage.handleGroupCreated│
│ → groups.json   │  │     → workSessionStore.createLink    │
└─────────────────┘  └──────────────────────────────────────┘
                            │
                            ▼
                   ┌──────────────────────────────────────┐
                   │ 4. Backend: create_link              │
                   │    - session.json에 link 저장        │
                   │    - SyncManager로 groups.json에     │
                   │      link 필드 추가                   │
                   └──────────────────────────────────────┘
```

### 2.2 현재 해설 그룹 저장 위치

```
dataset_root/
└── {solution_document_id}/
    └── groups/
        └── page_0001_groups.json
            {
              "groups": [
                {
                  "id": "A1",
                  "block_ids": [0, 1, 2],
                  "status": "confirmed",
                  "link": {                          ← ✅ 연결 정보 있음
                    "linkedGroupId": "B2",
                    "linkedDocumentId": "problem_doc",
                    "linkType": "solution"
                  }
                }
              ]
            }
```

### 2.3 현재 문제점

| 문제 | 상세 |
|------|------|
| **그룹은 저장됨** | ✅ groups.json에 정상 저장 |
| **캔버스에 표시됨** | ✅ PageCanvas에서 localGroups 사용 |
| **시각적 구분 없음** | ❌ 문제 vs 해설 그룹 스타일 동일 |
| **연결 상태 표시 없음** | ❌ 어떤 문제와 연결됐는지 표시 안 됨 |

---

## 3. 구현 방안

### 3.1 방안 A: 연결 상태 뱃지 추가 (권장)

**개요**: 해설 그룹에 연결된 문제 번호 뱃지 표시

```
┌──────────────────────────────────────────┐
│  해설 문서 페이지                         │
│                                          │
│  ┌─────────────────────────────┐         │
│  │ 3번 해설  ← 연결 뱃지        │         │
│  │ ┌─────────────────────────┐ │         │
│  │ │ 해설 내용 블록들...     │ │         │
│  │ └─────────────────────────┘ │         │
│  └─────────────────────────────┘         │
│                                          │
│  ┌─────────────────────────────┐         │
│  │ 5번 해설                     │         │
│  │ ┌─────────────────────────┐ │         │
│  │ │ 해설 내용 블록들...     │ │         │
│  │ └─────────────────────────┘ │         │
│  └─────────────────────────────┘         │
└──────────────────────────────────────────┘
```

**구현 난이도**: ⭐⭐ (중간)

**변경 파일**:
- `PageCanvas.tsx`: 그룹 렌더링 시 link 정보 확인
- `GroupPanel.tsx`: 연결 상태 뱃지 표시

### 3.2 방안 B: 색상 구분 추가

**개요**: 문제 그룹(파란색) vs 해설 그룹(보라색/주황색)

```css
/* 문제 그룹 */
.group-problem {
  border-color: #3B82F6; /* blue-500 */
  background: rgba(59, 130, 246, 0.1);
}

/* 해설 그룹 (연결됨) */
.group-solution-linked {
  border-color: #8B5CF6; /* purple-500 */
  background: rgba(139, 92, 246, 0.1);
}

/* 해설 그룹 (미연결) */
.group-solution-unlinked {
  border-color: #F59E0B; /* amber-500 */
  background: rgba(245, 158, 11, 0.1);
}
```

**구현 난이도**: ⭐ (쉬움)

**변경 파일**:
- `PageCanvas.tsx`: linkType에 따른 스타일 분기

### 3.3 방안 C: 좌측 패널에 해설 목록 추가

**개요**: 문제 목록 패널처럼 해설 목록 패널 추가

```
┌─────────────┬──────────────────────────┐
│ 매칭 완료   │                          │
│ ✓ 1번→R1   │                          │
│ ✓ 2번→R2   │     해설 문서 캔버스     │
│ ✓ 3번→R3   │                          │
├─────────────┤                          │
│ 현재 페이지 │                          │
│ 해설 그룹   │                          │
│ • R1 (1번) │                          │
│ • R2 (2번) │                          │
└─────────────┴──────────────────────────┘
```

**구현 난이도**: ⭐⭐⭐ (높음)

**변경 파일**:
- 새 컴포넌트: `SolutionGroupPanel.tsx`
- `UnifiedWorkPage.tsx`: 패널 통합

---

## 4. 구현 가능성 평가

### 4.1 기술적 가능성: ✅ 높음

| 항목 | 상태 | 근거 |
|------|------|------|
| **데이터 이미 있음** | ✅ | groups.json에 link 필드 저장됨 |
| **프론트엔드 로딩** | ✅ | usePageGroups가 link 포함해서 로드 |
| **타입 정의 있음** | ✅ | GroupLink 타입 정의됨 |
| **기존 컴포넌트 재사용** | ✅ | PageCanvas, GroupPanel 확장 가능 |

### 4.2 예상 작업량

| 방안 | 예상 시간 | 파일 수 |
|------|----------|---------|
| A: 뱃지 추가 | 1-2시간 | 2-3개 |
| B: 색상 구분 | 30분-1시간 | 1-2개 |
| C: 패널 추가 | 3-4시간 | 4-5개 |

---

## 5. 우려 사항

### 5.1 UX 복잡성 증가 ⚠️

| 우려 | 상세 | 대응 |
|------|------|------|
| **정보 과부하** | 그룹 정보가 너무 많으면 혼란 | 토글로 표시/숨김 옵션 |
| **색상 혼동** | 문제/해설 색상 구분 어려움 | 명확한 레전드 표시 |
| **스크롤 문제** | 해설이 여러 페이지에 분산 | 페이지별 그룹 카운트 표시 |

### 5.2 성능 영향 ⚠️

| 우려 | 상세 | 대응 |
|------|------|------|
| **추가 데이터 로딩** | link 정보 추가 로딩 | 이미 포함됨, 영향 없음 |
| **렌더링 오버헤드** | 뱃지/색상 추가 렌더링 | 미미한 수준 |
| **캐시 무효화** | 연결 시 캐시 갱신 필요 | invalidateQueries 활용 |

### 5.3 데이터 일관성 ⚠️

| 우려 | 상세 | 대응 |
|------|------|------|
| **동기화 지연** | link 저장과 UI 갱신 불일치 | optimistic update 적용 |
| **연결 삭제 시** | 해설 그룹은 남지만 link 사라짐 | 미연결 상태로 표시 |
| **문서 간 참조** | 문제 문서 삭제 시 해설 link 깨짐 | soft reference 유지 |

### 5.4 워크플로우 충돌 가능성 ⚠️

| 우려 | 상세 | 대응 |
|------|------|------|
| **해설 수정 시** | 연결된 해설 그룹 수정하면? | 연결 유지, 그룹만 수정 |
| **해설 삭제 시** | 연결된 해설 삭제하면? | link도 함께 삭제 필요 |
| **재연결 시** | 같은 문제에 다른 해설 연결 | 기존 연결 덮어쓰기 (현재 동작) |

---

## 6. 권장 구현 순서

### Phase 42-A: 기본 시각화 (우선 구현)

```
1. PageCanvas에서 link 있는 그룹 색상 변경 (보라색)
2. 그룹 박스 상단에 연결된 문제 번호 표시
3. GroupPanel에서 연결 상태 뱃지 표시
```

### Phase 42-B: 상세 정보 (선택 구현)

```
1. 연결된 해설 클릭 시 문제 페이지로 이동
2. 해설 그룹 목록 패널 추가
3. 전체 연결 현황 시각화
```

---

## 7. 핵심 코드 변경 예시

### 7.1 PageCanvas 그룹 렌더링 수정

```typescript
// PageCanvas.tsx
const getGroupStyle = (group: ProblemGroup) => {
  const hasLink = group.link != null;
  const linkType = group.link?.linkType;

  if (linkType === 'solution') {
    // 해설 그룹 (문제와 연결됨)
    return {
      borderColor: '#8B5CF6', // purple
      backgroundColor: 'rgba(139, 92, 246, 0.1)',
      label: group.link?.linkedName || '해설',
    };
  }

  // 기본 문제 그룹
  return {
    borderColor: '#3B82F6', // blue
    backgroundColor: 'rgba(59, 130, 246, 0.1)',
    label: group.problemInfo?.problemNumber || group.id,
  };
};
```

### 7.2 GroupPanel 연결 뱃지 추가

```typescript
// GroupPanel.tsx
{group.link && (
  <Badge variant="subtle" className="bg-purple-100 text-purple-700">
    <Link2 className="w-3 h-3 mr-1" />
    {group.link.linkedName}과 연결됨
  </Badge>
)}
```

---

## 8. 결론

| 항목 | 결론 |
|------|------|
| **구현 가능성** | ✅ 높음 (데이터, 타입, 컴포넌트 모두 준비됨) |
| **권장 방안** | 방안 A + B 조합 (뱃지 + 색상 구분) |
| **예상 작업량** | 1-2시간 |
| **주요 우려** | UX 복잡성 → 토글 옵션으로 해결 |
| **선행 작업** | 없음 (현재 상태로 바로 구현 가능) |

### 다음 단계

1. 사용자 승인 후 Phase 42-A 구현 시작
2. PageCanvas 색상 분기 추가
3. GroupPanel 연결 뱃지 추가
4. 테스트 후 피드백 반영

---

*작성: Claude Code | 2025-12-04*
